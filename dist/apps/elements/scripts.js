function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}(function(e){e.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var r,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(h){return"function"===e.type(h)},e.isArray=Array.isArray||function(h){return"array"===e.type(h)},e.isWindow=function(h){return h&&"object"==typeof h&&"setInterval"in h},e.type=function(h){return null==h?String(h):t[i.call(h)]||"object"},e.isPlainObject=function(h){if(!h||"object"!==OpenSeadragon.type(h)||h.nodeType||e.isWindow(h)||h.constructor&&!n.call(h,"constructor")&&!n.call(h.constructor.prototype,"isPrototypeOf"))return!1;var l;for(var c in h)l=c;return void 0===l||n.call(h,l)},e.isEmptyObject=function(h){for(var l in h)return!1;return!0},e.freezeObject=function(h){return e.freezeObject=Object.freeze?Object.freeze:function(l){return l},e.freezeObject(h)},e.supportsCanvas=(r=document.createElement("canvas"),!(!e.isFunction(r.getContext)||!r.getContext("2d"))),e.isCanvasTainted=function(h){var l=!1;try{h.getContext("2d").getImageData(0,0,1,1)}catch(c){l=!0}return l},e.pixelDensityRatio=function(){if(e.supportsCanvas){var h=document.createElement("canvas").getContext("2d"),l=window.devicePixelRatio||1,c=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;return Math.max(l,1)/c}return 1}()})(OpenSeadragon),function($){$.extend=function(){var e,t,i,n,r,h,l=arguments[0]||{},c=arguments.length,o=!1,d=1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},d=2),"object"==typeof l||OpenSeadragon.isFunction(l)||(l={}),c===d&&(l=this,--d);d<c;d++)if(null!==(e=arguments[d])||void 0!==e)for(t in e)i=l[t],l!==(n=e[t])&&(o&&n&&(OpenSeadragon.isPlainObject(n)||(r=OpenSeadragon.isArray(n)))?(r?(r=!1,h=i&&OpenSeadragon.isArray(i)?i:[]):h=i&&OpenSeadragon.isPlainObject(i)?i:{},l[t]=OpenSeadragon.extend(o,h,n)):void 0!==n&&(l[t]=n));return l};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,n=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)n.x+=e.offsetLeft,n.y+=e.offsetTop,t&&(n=n.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return n},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,r={top:0,left:0};return n?(t=n.documentElement,void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),new $.Point(r.left+((i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow)).pageXOffset||t.scrollLeft)-(t.clientLeft||0),r.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(i){if(void 0!==t[i])return t[i];var n=document.createElement("div").style,r=null;if(void 0!==n[i])r=i;else for(var h=["Webkit","Moz","MS","O","webkit","moz","ms","o"],l=$.capitalizeFirstLetter(i),c=0;c<h.length;c++){var o=h[c]+l;if(void 0!==n[o]){r=o;break}}return t[i]=r},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(t){return t}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(t){var i=new $.Point;return t=$.getEvent(t),i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(t){var i=new $.Point;return t=$.getEvent(t),i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(n){window.scrollTo(n.x,n.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(n){document.body.scrollLeft=n.x,document.body.scrollTop=n.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(n){document.documentElement.scrollLeft=n.x,document.documentElement.scrollTop=n.y});$.setPageScroll=function(n){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return $.now=Date.now?Date.now:function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(t){var i=$.makeNeutralElement("img");return i.src=t,i},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(t){var i=$.makeNeutralElement("img"),n=null;return(n=$.makeNeutralElement("span")).style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=t,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",n}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return this.indexOf=Array.prototype.indexOf?function(n,r,h){return n.indexOf(r,h)}:function(n,r,h){var l,c,o=h||0;if(!n)throw new TypeError;if(0===(c=n.length)||c<=o)return-1;for(o<0&&(o=c-Math.abs(o)),l=o;l<c;l++)if(n[l]===r)return l;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,n,r=[];for(i=(e=$.getElement(e)).className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==t&&r.push(i[n]);e.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i,n){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i,n){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){$.cancelEvent=(e=$.getEvent(e)).preventDefault?function(t){t.preventDefault()}:function(t){(t=$.getEvent(t)).cancel=!0,t.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){$.stopEvent=(e=$.getEvent(e)).stopPropagation?function(t){t.stopPropagation()}:function(t){(t=$.getEvent(t)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var r,h=n.concat([]);for(r=0;r<arguments.length;r++)h.push(arguments[r]);return t.apply(e,h)}},getUrlParameter:function(e){return URLPARAMS[e]||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t=!1}if(t)$.createAjaxRequest=window.XMLHttpRequest?function(i){return i?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var n,r,h;$.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,r=e.headers,h=e.responseType||null,e=e.url);var l=$.getUrlProtocol(e),c=$.createAjaxRequest("file:"===l);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=function(){},200<=c.status&&c.status<300||0===c.status&&"http:"!==l&&"https:"!==l?t(c):($.console.log("AJAX request returned %d: %s",c.status,e),$.isFunction(i)&&i(c)))};try{if(c.open("GET",e,!0),h&&(c.responseType=h),r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&c.setRequestHeader(o,r[o]);n&&(c.withCredentials=!0),c.send(null)}catch(y){var d=y.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==y.number&&-2147024891==y.number&&(d+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",y.name,d),c.onreadystatechange=function(){},window.XDomainRequest){var g=new window.XDomainRequest;if(g){g.onload=function(T){$.isFunction(t)&&t({responseText:g.responseText,status:200,statusText:"OK"})},g.onerror=function(T){$.isFunction(i)&&i({responseText:g.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{g.open("GET",e),g.send()}catch(T){$.isFunction(i)&&i(c,y)}}}else $.isFunction(i)&&i(c,y)}return c},jsonp:function(e){var t,i=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=e.callbackName||"openseadragon"+$.now(),h=window[r],c=e.param||"callback",o=e.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,"$1"+r+"$2"),i+=(/\?/.test(i)?"&":"?")+c+"="+r,window[r]=function(d){if(h)window[r]=h;else try{delete window[r]}catch(g){}o&&$.isFunction(o)&&o(d)},t=document.createElement("script"),void 0===e.async&&!1===e.async||(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=i,t.onload=t.onreadystatechange=function(d,g){(g||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,n&&t.parentNode&&n.removeChild(t),t=void 0)},n.insertBefore(t,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(t){return(new DOMParser).parseFromString(t,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(t){var i=null;return(i=new ActiveXObject("Microsoft.XMLDOM")).async=!1,i.loadXML(t),i}}return $.parseXml(e)},parseJSON:function(string){return $.parseJSON=window.JSON&&window.JSON.parse?window.JSON.parse:function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}(function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=t.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):0<=t.indexOf("Safari")?($.Browser.vendor=0<=t.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,n,r,h=window.location.search.substring(1).split("&");for(r=0;r<h.length;r++)if(0<(n=(i=h[r]).indexOf("="))){var l=i.substring(0,n),c=i.substring(n+1);try{URLPARAMS[l]=decodeURIComponent(c)}catch(o){$.console.error("Ignoring malformed URL parameter: %s=%s",l,c)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var n,r=[],h=[],l=0;$.requestAnimationFrame=function(c){return r.push([++l,c]),n=n||setInterval(function(){if(r.length){var o=$.now(),d=h;for(h=r,r=d;h.length;)h.shift()[1](o)}else clearInterval(n),n=void 0},20),l},$.cancelAnimationFrame=function(c){var o,d;for(o=0,d=r.length;o<d;o+=1)if(r[o][0]===c)return void r.splice(o,1);for(o=0,d=h.length;o<d;o+=1)if(h[o][0]===c)return void h.splice(o,1)}}}(window)}(OpenSeadragon),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t()}(this,function(){return OpenSeadragon}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(i){return i.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(i){return i.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(i){return i.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(t,i,n,r){var h=this;r=r||1;var l=0,c=function(o){++l===r&&h.removeHandler(t,c),i(o)};this.addHandler(t,c,n)},addHandler:function(t,i,n){var r=this.events[t];r||(this.events[t]=r=[]),i&&e.isFunction(i)&&(r[r.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,r=this.events[t],h=[];if(r&&e.isArray(r)){for(n=0;n<r.length;n++)r[n].handler!==i&&h.push(r[n]);this.events[t]=h}},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(t){var i=this.events[t];return i&&i.length?(i=1===i.length?[i[0]]:Array.apply(null,i),function(n,r){var h,l=i.length;for(h=0;h<l;h++)i[h]&&(r.eventSource=n,r.userData=i[h].userData,i[h].handler(r))}):null},raiseEvent:function(t,i){var n=this.getHandler(t);n&&n(this,i=i||{})}}}(OpenSeadragon),function(e){var h,l,c,o,t=[],i={};function n(a,u){return a.hash.toString()+u.type+u.id.toString()}function r(){var a,u,p,m,w,O=h.length,k=e.now();for(m=k-c,c=k,a=0;a<O;a++)(p=(u=h[a]).gPoint).direction=Math.atan2(p.currentPos.y-u.lastPos.y,p.currentPos.x-u.lastPos.x),w=u.lastPos.distanceTo(p.currentPos),u.lastPos=p.currentPos,p.speed=1e3*w/(1+m)*.75+.25*p.speed}function d(a){var u,p=i[a.hash],m=p.activePointersLists.length;for(u=0;u<m;u++)0<p.activePointersLists[u].captureCount&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",p.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",p.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",p.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",p.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",p.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",p.touchendcaptured,!0),p.activePointersLists[u].captureCount=0);for(u=0;u<m;u++)p.activePointersLists.pop()}function g(a){var u,p,m=i[a.hash];if(m.tracking){for(p=0;p<e.MouseTracker.subscribeEvents.length;p++)e.removeEvent(a.element,u=e.MouseTracker.subscribeEvents[p],m[u],!1);d(a),m.tracking=!1}}function y(a,u){var p=i[a.hash];if("pointerevent"===u)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:p.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:p.pointermovecaptured};if("mouse"===u)return{upName:"mouseup",upHandler:p.mouseupcaptured,moveName:"mousemove",moveHandler:p.mousemovecaptured};if("touch"===u)return{upName:"touchend",upHandler:p.touchendcaptured,moveName:"touchmove",moveHandler:p.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function T(a,u,p){var m,w=a.getActivePointersListByType(u);w.captureCount+=p||1,1===w.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?a.element.setCapture(!0):(m=y(a,e.MouseTracker.havePointerEvents?"pointerevent":u),s&&v(window.top)&&e.addEvent(window.top,m.upName,m.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,m.upName,m.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,m.moveName,m.moveHandler,!0)))}function x(a,u,p){var m,w=a.getActivePointersListByType(u);w.captureCount-=p||1,0===w.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?a.element.releaseCapture():(m=y(a,e.MouseTracker.havePointerEvents?"pointerevent":u),s&&v(window.top)&&e.removeEvent(window.top,m.upName,m.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,m.moveName,m.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,m.upName,m.upHandler,!0)))}function S(a){var u;if(e.MouseTracker.unprefixedPointerEvents)u=a.pointerType;else switch(a.pointerType){case 2:u="touch";break;case 3:u="pen";break;case 4:u="mouse";break;default:u=""}return u}function P(a){return e.getMousePosition(a)}function R(a,u){return I(P(a),u)}function I(a,u){var p=e.getElementOffset(u);return a.minus(p)}function H(a,u){return new e.Point((a.x+u.x)/2,(a.y+u.y)/2)}function j(a,u){var p={target:(u=e.getEvent(u)).target||u.srcElement,type:"wheel",shiftKey:u.shiftKey||!1,clientX:u.clientX,clientY:u.clientY,pageX:u.pageX?u.pageX:u.clientX,pageY:u.pageY?u.pageY:u.clientY,deltaMode:"MozMousePixelScroll"==u.type?0:1,deltaX:0,deltaZ:0};p.deltaY="mousewheel"==e.MouseTracker.wheelEventName?-u.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:u.detail,F(a,p,u)}function F(a,u,p){var m;m=u.deltaY<0?1:-1,a.scrollHandler&&!1===a.scrollHandler({eventSource:a,pointerType:"mouse",position:R(u,a.element),scroll:m,shift:u.shiftKey,isTouchEvent:!1,originalEvent:p,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(p)}function G(a,u){if(a===u)return!1;for(;u&&u!==a;)u=u.parentNode;return u===a}function K(a,u){J(a,u,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:P(u),currentTime:e.now()}])}function _(a,u){ee(a,u,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:P(u),currentTime:e.now()}])}function D(a){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===a?0:2===a?2:4===a?1:-1:a}function z(a,u){ae(a,u=e.getEvent(u),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:P(u),currentTime:e.now()}],D(u.button))&&x(a,"mouse")}function M(a,u){le(a,u=e.getEvent(u),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:P(u),currentTime:e.now()}])}function N(a,u,p){var m,w=p.getLength(),f=[];if("touch"===p.type||0<p.contacts){for(m=0;m<w;m++)f.push(p.getByIndex(m));0<f.length&&(ae(a,u,f,0),p.captureCount=1,x(a,p.type),ee(a,u,f))}}function U(a,u){var p,m,w,f,O=u.changedTouches.length,k=[];for(p=e.now(),m=0;m<O;m++)k.push({id:u.changedTouches[m].identifier,type:"touch",currentPos:P(u.changedTouches[m]),currentTime:p});for(ae(a,u,k,0)&&x(a,"touch",O),ee(a,u,k),m=0;m<t.length;m++)if(t[m]!==a&&t[m].isTracking()&&G(t[m].element,a.element)){for(f=[],w=0;w<O;w++)f.push({id:u.changedTouches[w].identifier,type:"touch",currentPos:P(u.changedTouches[w]),currentTime:p});ee(t[m],u,f)}e.cancelEvent(u)}function C(a,u){var p,m=u.changedTouches.length,w=[];for(p=0;p<m;p++)w.push({id:u.changedTouches[p].identifier,type:"touch",currentPos:P(u.changedTouches[p]),currentTime:e.now()});le(a,u,w),e.cancelEvent(u)}function W(a,u){u.currentTarget===u.relatedTarget||G(u.currentTarget,u.relatedTarget)||J(a,u,[{id:u.pointerId,type:S(u),isPrimary:u.isPrimary,currentPos:P(u),currentTime:e.now()}])}function A(a,u){u.currentTarget===u.relatedTarget||G(u.currentTarget,u.relatedTarget)||ee(a,u,[{id:u.pointerId,type:S(u),isPrimary:u.isPrimary,currentPos:P(u),currentTime:e.now()}])}function q(a,u){var p;te(a,u,[p={id:u.pointerId,type:S(u),isPrimary:u.isPrimary,currentPos:P(u),currentTime:e.now()}],u.button)&&(e.stopEvent(u),T(a,p.type)),(a.clickHandler||a.dblClickHandler||a.pressHandler||a.dragHandler||a.dragEndHandler||a.pinchHandler)&&e.cancelEvent(u)}function Z(a,u){V(a,u)}function V(a,u){var p;ae(a,u,[p={id:u.pointerId,type:S(u),isPrimary:u.isPrimary,currentPos:P(u),currentTime:e.now()}],u.button)&&x(a,p.type)}function Y(a,u){Q(a,u)}function Q(a,u){le(a,u,[{id:u.pointerId,type:S(u),isPrimary:u.isPrimary,currentPos:P(u),currentTime:e.now()}])}function oe(a,u){var p,m,w;ae(p=a,m=u,w=[{id:u.pointerId,type:S(u)}],0),ee(p,m,w)}function re(a,u){return Object.prototype.hasOwnProperty.call(u,"isPrimary")||(u.isPrimary=0===a.getLength()),u.speed=0,u.direction=0,u.contactPos=u.currentPos,u.contactTime=u.currentTime,u.lastPos=u.currentPos,u.lastTime=u.currentTime,a.add(u)}function ne(a,u){var p,m;return a.getById(u.id)?(p=a.removeById(u.id),Object.prototype.hasOwnProperty.call(u,"isPrimary")||(m=a.getPrimary())||(m=a.getByIndex(0))&&(m.isPrimary=!0)):p=a.getLength(),p}function J(a,u,p){var m,w,f,O=a.getActivePointersListByType(p[0].type),k=p.length;for(m=0;m<k;m++)(f=O.getById((w=p[m]).id))?(f.insideElement=!0,f.lastPos=f.currentPos,f.lastTime=f.currentTime,f.currentPos=w.currentPos,f.currentTime=w.currentTime,w=f):(w.captured=!1,w.insideElementPressed=!1,w.insideElement=!0,re(O,w)),a.enterHandler&&!1===a.enterHandler({eventSource:a,pointerType:w.type,position:I(w.currentPos,a.element),buttons:O.buttons,pointers:a.getActivePointerCount(),insideElementPressed:w.insideElementPressed,buttonDownAny:0!==O.buttons,isTouchEvent:"touch"===w.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u)}function ee(a,u,p){var m,w,f,O=a.getActivePointersListByType(p[0].type),k=p.length;for(m=0;m<k;m++)(f=O.getById((w=p[m]).id))&&(f.captured?(f.insideElement=!1,f.lastPos=f.currentPos,f.lastTime=f.currentTime,f.currentPos=w.currentPos,f.currentTime=w.currentTime):ne(O,f),w=f),a.exitHandler&&!1===a.exitHandler({eventSource:a,pointerType:w.type,position:w.currentPos&&I(w.currentPos,a.element),buttons:O.buttons,pointers:a.getActivePointerCount(),insideElementPressed:!!f&&f.insideElementPressed,buttonDownAny:0!==O.buttons,isTouchEvent:"touch"===w.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u)}function te(a,u,p,m){var w,f,O,k=i[a.hash],E=a.getActivePointersListByType(p[0].type),L=p.length;void 0!==u.buttons?E.buttons=u.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===m?E.buttons+=1:1===m?E.buttons+=4:2===m?E.buttons+=2:3===m?E.buttons+=8:4===m?E.buttons+=16:5===m&&(E.buttons+=32):0===m?E.buttons|=1:1===m?E.buttons|=4:2===m?E.buttons|=2:3===m?E.buttons|=8:4===m?E.buttons|=16:5===m&&(E.buttons|=32);var b=a.getActivePointersListsExceptType(p[0].type);for(w=0;w<b.length;w++)N(a,u,b[w]);if(0!==m)return a.nonPrimaryPressHandler&&!1===a.nonPrimaryPressHandler({eventSource:a,pointerType:p[0].type,position:I(p[0].currentPos,a.element),button:m,buttons:E.buttons,isTouchEvent:"touch"===p[0].type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u),!1;for(w=0;w<L;w++)(O=E.getById((f=p[w]).id))?(O.captured=!0,O.insideElementPressed=!0,O.insideElement=!0,O.contactPos=f.currentPos,O.contactTime=f.currentTime,O.lastPos=O.currentPos,O.lastTime=O.currentTime,O.currentPos=f.currentPos,O.currentTime=f.currentTime,f=O):(f.captured=!0,f.insideElementPressed=!0,f.insideElement=!0,re(E,f)),E.addContact(),(a.dragHandler||a.dragEndHandler||a.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(a,f),1===E.contacts?a.pressHandler&&!1===a.pressHandler({eventSource:a,pointerType:f.type,position:I(f.contactPos,a.element),buttons:E.buttons,isTouchEvent:"touch"===f.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u):2===E.contacts&&a.pinchHandler&&"touch"===f.type&&(k.pinchGPoints=E.asArray(),k.lastPinchDist=k.currentPinchDist=k.pinchGPoints[0].currentPos.distanceTo(k.pinchGPoints[1].currentPos),k.lastPinchCenter=k.currentPinchCenter=H(k.pinchGPoints[0].currentPos,k.pinchGPoints[1].currentPos));return!0}function ae(a,u,p,m){var w,f,O,k,E,L,b=i[a.hash],B=a.getActivePointersListByType(p[0].type),X=p.length,ie=!1,se=!1;if(void 0!==u.buttons?B.buttons=u.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===m?--B.buttons:1===m?B.buttons-=4:2===m?B.buttons-=2:3===m?B.buttons-=8:4===m?B.buttons-=16:5===m&&(B.buttons-=32):0===m?B.buttons^=-2:1===m?B.buttons^=-5:2===m?B.buttons^=-3:3===m?B.buttons^=-9:4===m?B.buttons^=-17:5===m&&(B.buttons^=-33),0!==m){a.nonPrimaryReleaseHandler&&!1===a.nonPrimaryReleaseHandler({eventSource:a,pointerType:p[0].type,position:I(p[0].currentPos,a.element),button:m,buttons:B.buttons,isTouchEvent:"touch"===p[0].type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u);var he=a.getActivePointersListByType("mouse");return N(a,u,he),!1}if(void 0===p[0].currentPos)return N(a,u,B),!1;for(O=0;O<X;O++)(E=B.getById((k=p[O]).id))&&(E.captured&&(se=ie=!(E.captured=!1)),E.lastPos=E.currentPos,E.lastTime=E.currentTime,E.currentPos=k.currentPos,E.currentTime=k.currentTime,E.insideElement||ne(B,E),w=E.currentPos,f=E.currentTime,se?(B.removeContact(),(a.dragHandler||a.dragEndHandler||a.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(a,E),0===B.contacts?(a.releaseHandler&&!1===a.releaseHandler({eventSource:a,pointerType:E.type,position:I(w,a.element),buttons:B.buttons,insideElementPressed:E.insideElementPressed,insideElementReleased:E.insideElement,isTouchEvent:"touch"===E.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u),a.dragEndHandler&&!E.currentPos.equals(E.contactPos)&&!1===a.dragEndHandler({eventSource:a,pointerType:E.type,position:I(E.currentPos,a.element),speed:E.speed,direction:E.direction,shift:u.shiftKey,isTouchEvent:"touch"===E.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u),(a.clickHandler||a.dblClickHandler)&&E.insideElement&&(L=f-E.contactTime<=a.clickTimeThreshold&&E.contactPos.distanceTo(w)<=a.clickDistThreshold,a.clickHandler&&!1===a.clickHandler({eventSource:a,pointerType:E.type,position:I(E.currentPos,a.element),quick:L,shift:u.shiftKey,isTouchEvent:"touch"===E.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u),a.dblClickHandler&&L&&(B.clicks++,1===B.clicks?(b.lastClickPos=w,b.dblClickTimeOut=setTimeout(function(){B.clicks=0},a.dblClickTimeThreshold)):2===B.clicks&&(clearTimeout(b.dblClickTimeOut),B.clicks=0,b.lastClickPos.distanceTo(w)<=a.dblClickDistThreshold&&!1===a.dblClickHandler({eventSource:a,pointerType:E.type,position:I(E.currentPos,a.element),shift:u.shiftKey,isTouchEvent:"touch"===E.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u),b.lastClickPos=null)))):2===B.contacts&&a.pinchHandler&&"touch"===E.type&&(b.pinchGPoints=B.asArray(),b.lastPinchDist=b.currentPinchDist=b.pinchGPoints[0].currentPos.distanceTo(b.pinchGPoints[1].currentPos),b.lastPinchCenter=b.currentPinchCenter=H(b.pinchGPoints[0].currentPos,b.pinchGPoints[1].currentPos))):a.releaseHandler&&!1===a.releaseHandler({eventSource:a,pointerType:E.type,position:I(w,a.element),buttons:B.buttons,insideElementPressed:E.insideElementPressed,insideElementReleased:E.insideElement,isTouchEvent:"touch"===E.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u));return ie}function le(a,u,p){var m,w,f,O,k,E=i[a.hash],L=a.getActivePointersListByType(p[0].type),b=p.length;for(void 0!==u.buttons&&(L.buttons=u.buttons),m=0;m<b;m++)(f=L.getById((w=p[m]).id))?(Object.prototype.hasOwnProperty.call(w,"isPrimary")&&(f.isPrimary=w.isPrimary),f.lastPos=f.currentPos,f.lastTime=f.currentTime,f.currentPos=w.currentPos,f.currentTime=w.currentTime):(w.captured=!1,w.insideElementPressed=!1,w.insideElement=!0,re(L,w));a.stopHandler&&"mouse"===p[0].type&&(clearTimeout(a.stopTimeOut),a.stopTimeOut=setTimeout(function(){var B,X,ie;X=u,ie=p[0].type,(B=a).stopHandler&&B.stopHandler({eventSource:B,pointerType:ie,position:R(X,B.element),buttons:B.getActivePointersListByType(ie).buttons,isTouchEvent:"touch"===ie,originalEvent:X,preventDefaultAction:!1,userData:B.userData})},a.stopDelay)),0===L.contacts?a.moveHandler&&!1===a.moveHandler({eventSource:a,pointerType:p[0].type,position:I(p[0].currentPos,a.element),buttons:L.buttons,isTouchEvent:"touch"===p[0].type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u):1===L.contacts?(a.moveHandler&&(f=L.asArray()[0],!1===a.moveHandler({eventSource:a,pointerType:f.type,position:I(f.currentPos,a.element),buttons:L.buttons,isTouchEvent:"touch"===f.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u)),a.dragHandler&&(k=(f=L.asArray()[0]).currentPos.minus(f.lastPos),!1===a.dragHandler({eventSource:a,pointerType:f.type,position:I(f.currentPos,a.element),buttons:L.buttons,delta:k,speed:f.speed,direction:f.direction,shift:u.shiftKey,isTouchEvent:"touch"===f.type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u))):2===L.contacts&&(a.moveHandler&&(O=L.asArray(),!1===a.moveHandler({eventSource:a,pointerType:O[0].type,position:I(H(O[0].currentPos,O[1].currentPos),a.element),buttons:L.buttons,isTouchEvent:"touch"===O[0].type,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u)),a.pinchHandler&&"touch"===p[0].type&&(k=E.pinchGPoints[0].currentPos.distanceTo(E.pinchGPoints[1].currentPos))!=E.currentPinchDist&&(E.lastPinchDist=E.currentPinchDist,E.currentPinchDist=k,E.lastPinchCenter=E.currentPinchCenter,E.currentPinchCenter=H(E.pinchGPoints[0].currentPos,E.pinchGPoints[1].currentPos),!1===a.pinchHandler({eventSource:a,pointerType:"touch",gesturePoints:E.pinchGPoints,lastCenter:I(E.lastPinchCenter,a.element),center:I(E.currentPinchCenter,a.element),lastDistance:E.lastPinchDist,distance:E.currentPinchDist,shift:u.shiftKey,originalEvent:u,preventDefaultAction:!1,userData:a.userData})&&e.cancelEvent(u)))}e.MouseTracker=function(a){t.push(this);var u=arguments;e.isPlainObject(a)||(a={element:u[0],clickTimeThreshold:u[1],clickDistThreshold:u[2]}),this.hash=Math.random(),this.element=e.getElement(a.element),this.clickTimeThreshold=a.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=a.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=a.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=a.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=a.userData||null,this.stopDelay=a.stopDelay||50,this.enterHandler=a.enterHandler||null,this.exitHandler=a.exitHandler||null,this.pressHandler=a.pressHandler||null,this.nonPrimaryPressHandler=a.nonPrimaryPressHandler||null,this.releaseHandler=a.releaseHandler||null,this.nonPrimaryReleaseHandler=a.nonPrimaryReleaseHandler||null,this.moveHandler=a.moveHandler||null,this.scrollHandler=a.scrollHandler||null,this.clickHandler=a.clickHandler||null,this.dblClickHandler=a.dblClickHandler||null,this.dragHandler=a.dragHandler||null,this.dragEndHandler=a.dragEndHandler||null,this.pinchHandler=a.pinchHandler||null,this.stopHandler=a.stopHandler||null,this.keyDownHandler=a.keyDownHandler||null,this.keyUpHandler=a.keyUpHandler||null,this.keyHandler=a.keyHandler||null,this.focusHandler=a.focusHandler||null,this.blurHandler=a.blurHandler||null;var p=this;i[this.hash]={click:function(m){p.clickHandler&&e.cancelEvent(m)},dblclick:function(m){p.dblClickHandler&&e.cancelEvent(m)},keydown:function(m){var w,f;f=m,(w=p).keyDownHandler&&(f=e.getEvent(f),w.keyDownHandler({eventSource:w,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefaultAction:!1,userData:w.userData})||e.cancelEvent(f))},keyup:function(m){var w,f;f=m,(w=p).keyUpHandler&&(f=e.getEvent(f),w.keyUpHandler({eventSource:w,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefaultAction:!1,userData:w.userData})||e.cancelEvent(f))},keypress:function(m){var w,f;f=m,(w=p).keyHandler&&(f=e.getEvent(f),w.keyHandler({eventSource:w,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefaultAction:!1,userData:w.userData})||e.cancelEvent(f))},focus:function(m){var w,f;f=m,(w=p).focusHandler&&(f=e.getEvent(f),!1===w.focusHandler({eventSource:w,originalEvent:f,preventDefaultAction:!1,userData:w.userData})&&e.cancelEvent(f))},blur:function(m){var w,f;f=m,(w=p).blurHandler&&(f=e.getEvent(f),!1===w.blurHandler({eventSource:w,originalEvent:f,preventDefaultAction:!1,userData:w.userData})&&e.cancelEvent(f))},wheel:function(m){var w;F(p,w=m,w)},mousewheel:function(m){j(p,m)},DOMMouseScroll:function(m){j(p,m)},MozMousePixelScroll:function(m){j(p,m)},mouseenter:function(m){K(p,e.getEvent(m))},mouseleave:function(m){_(p,e.getEvent(m))},mouseover:function(m){var w,f;w=p,(f=e.getEvent(f=m)).currentTarget===f.relatedTarget||G(f.currentTarget,f.relatedTarget)||K(w,f)},mouseout:function(m){var w,f;w=p,(f=e.getEvent(f=m)).currentTarget===f.relatedTarget||G(f.currentTarget,f.relatedTarget)||_(w,f)},mousedown:function(m){var w,f;te(w=p,f=e.getEvent(f=m),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:P(f),currentTime:e.now()}],D(f.button))&&(e.stopEvent(f),T(w,"mouse")),(w.clickHandler||w.dblClickHandler||w.pressHandler||w.dragHandler||w.dragEndHandler)&&e.cancelEvent(f)},mouseup:function(m){z(p,m)},mouseupcaptured:function(m){var f;z(p,f=m),e.stopEvent(f)},mousemove:function(m){M(p,m)},mousemovecaptured:function(m){var f;M(p,f=m),e.stopEvent(f)},touchstart:function(m){!function(w,f){var O,k,E,L,b=f.changedTouches.length,B=[],X=w.getActivePointersListByType("touch");for(O=e.now(),X.getLength()>f.touches.length-b&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),N(w,f,X)),k=0;k<b;k++)B.push({id:f.changedTouches[k].identifier,type:"touch",currentPos:P(f.changedTouches[k]),currentTime:O});for(J(w,f,B),k=0;k<t.length;k++)if(t[k]!==w&&t[k].isTracking()&&G(t[k].element,w.element)){for(L=[],E=0;E<b;E++)L.push({id:f.changedTouches[E].identifier,type:"touch",currentPos:P(f.changedTouches[E]),currentTime:O});J(t[k],f,L)}te(w,f,B,0)&&(e.stopEvent(f),T(w,"touch",b)),e.cancelEvent(f)}(p,m)},touchend:function(m){U(p,m)},touchendcaptured:function(m){var f;U(p,f=m),e.stopEvent(f)},touchmove:function(m){C(p,m)},touchmovecaptured:function(m){var f;C(p,f=m),e.stopEvent(f)},touchcancel:function(m){var w,f,O;f=m,O=(w=p).getActivePointersListByType("touch"),N(w,f,O)},gesturestart:function(m){var w;(w=m).stopPropagation(),w.preventDefault()},gesturechange:function(m){var w;(w=m).stopPropagation(),w.preventDefault()},pointerover:function(m){W(p,m)},MSPointerOver:function(m){W(p,m)},pointerout:function(m){A(p,m)},MSPointerOut:function(m){A(p,m)},pointerdown:function(m){q(p,m)},MSPointerDown:function(m){q(p,m)},pointerup:function(m){Z(p,m)},MSPointerUp:function(m){Z(p,m)},pointermove:function(m){Y(p,m)},MSPointerMove:function(m){Y(p,m)},pointercancel:function(m){oe(p,m)},MSPointerCancel:function(m){oe(p,m)},pointerupcaptured:function(m){var w,f;(w=p).getActivePointersListByType(S(f=m)).getById(f.pointerId)&&V(w,f),e.stopEvent(f)},pointermovecaptured:function(m){var w,f;(w=p).getActivePointersListByType(S(f=m)).getById(f.pointerId)&&Q(w,f),e.stopEvent(f)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},a.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var a;for(g(this),this.element=null,a=0;a<t.length;a++)if(t[a]===this){t.splice(a,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(a){return(a?function(u){var p,m,w=i[u.hash];if(!w.tracking){for(m=0;m<e.MouseTracker.subscribeEvents.length;m++)e.addEvent(u.element,p=e.MouseTracker.subscribeEvents[m],w[p],!1);d(u),w.tracking=!0}}:g)(this),this},getActivePointersListsExceptType:function(a){for(var u=i[this.hash],p=[],m=0;m<u.activePointersLists.length;++m)u.activePointersLists[m].type!==a&&p.push(u.activePointersLists[m]);return p},getActivePointersListByType:function(a){var u,p,m=i[this.hash],w=m.activePointersLists.length;for(u=0;u<w;u++)if(m.activePointersLists[u].type===a)return m.activePointersLists[u];return p=new e.MouseTracker.GesturePointList(a),m.activePointersLists.push(p),p},getActivePointerCount:function(){var a,u=i[this.hash],p=u.activePointersLists.length,m=0;for(a=0;a<p;a++)m+=u.activePointersLists[a].getLength();return m},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var a=0;a<t.length;a++)t[a].isTracking()&&(t[a].setTracking(!1),t[a].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(h=[],c=l=0,{addPoint:function(a,u){var p=n(a,u);h.push({guid:p,gPoint:u,lastPos:u.currentPos}),1===h.length&&(c=e.now(),l=window.setInterval(r,50))},removePoint:function(a,u){var p,m=n(a,u),w=h.length;for(p=0;p<w;p++)if(h[p].guid===m){h.splice(p,1),0==--w&&window.clearInterval(l);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&8<e.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(o=document.createElement("div"),e.isFunction(o.setCapture)&&e.isFunction(o.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints?navigator.maxTouchPoints:0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints?navigator.msMaxTouchPoints:0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(a){this._gPoints=[],this.type=a,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(a){return this._gPoints.push(a)},removeById:function(a){var u,p=this._gPoints.length;for(u=0;u<p;u++)if(this._gPoints[u].id===a){this._gPoints.splice(u,1);break}return this._gPoints.length},getByIndex:function(a){return a<this._gPoints.length?this._gPoints[a]:null},getById:function(a){var u,p=this._gPoints.length;for(u=0;u<p;u++)if(this._gPoints[u].id===a)return this._gPoints[u];return null},getPrimary:function(a){var u,p=this._gPoints.length;for(u=0;u<p;u++)if(this._gPoints[u].isPrimary)return this._gPoints[u];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var s=function(){try{return window.self!==window.top}catch(a){return!0}}();function v(a){try{return a.addEventListener&&a.removeEventListener}catch(u){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var r=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){e.setElementOpacity(this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?this.element:this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(i,n){var r,h=i.controls;for(r=h.length-1;0<=r;r--)if(h[r].element==n)return r;return-1}e.ControlDock=function(i){var n,r,h=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),r=0;r<h.length;r++)this.controls[n=h[r]]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){var r=null;if(!(0<=t(this,i=e.getElement(i)))){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:r=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:r=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:r=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,r)),i.style.display="inline-block"}},removeControl:function(i){var n=t(this,i=e.getElement(i));return 0<=n&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var n;for(n=this.controls.length-1;0<=n;n--)this.controls[n].setVisible(i);return this}}}(OpenSeadragon),OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),function(e){var t={},i=1;function n(s){return s=e.getElement(s),new e.Point(0===s.clientWidth?1:s.clientWidth,0===s.clientHeight?1:s.clientHeight)}function r(s,v){if(v instanceof e.Overlay)return v;var a=null;if(v.element)a=e.getElement(v.element);else{var u=v.id?v.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(a=e.getElement(v.id))||((a=document.createElement("a")).href="#/overlay/"+u),a.id=u,e.addClass(a,v.className?v.className:"openseadragon-overlay")}var p=v.location,m=v.width,w=v.height;if(!p){var f=v.x,O=v.y;if(void 0!==v.px){var k=s.viewport.imageToViewportRectangle(new e.Rect(v.px,v.py,m||0,w||0));f=k.x,O=k.y,m=void 0!==m?k.width:void 0,w=void 0!==w?k.height:void 0}p=new e.Point(f,O)}var E=v.placement;return E&&"string"===e.type(E)&&(E=e.Placement[v.placement.toUpperCase()]),new e.Overlay({element:a,location:p,placement:E,onDraw:v.onDraw,checkResize:v.checkResize,width:m,height:w,rotationMode:v.rotationMode})}function h(s,v){var a;for(a=s.length-1;0<=a;a--)if(s[a].element===v)return a;return-1}function l(s,v){return e.requestAnimationFrame(function(){v(s)})}function c(s){e.requestAnimationFrame(function(){!function(v){var p,m;if(v.controlsShouldFade){for(p=1-(e.now()-v.controlsFadeBeginTime)/v.controlsFadeLength,p=Math.min(1,p),p=Math.max(0,p),m=v.controls.length-1;0<=m;m--)v.controls[m].autoFade&&v.controls[m].setOpacity(p);0<p&&c(v)}}(s)})}function o(s){s.autoHideControls&&(s.controlsShouldFade=!0,s.controlsFadeBeginTime=e.now()+s.controlsFadeDelay,window.setTimeout(function(){c(s)},s.controlsFadeDelay))}function d(s){var v;for(s.controlsShouldFade=!1,v=s.controls.length-1;0<=v;v--)s.controls[v].setOpacity(1)}function g(){d(this)}function y(){o(this)}function T(s){var v={originalEvent:s.originalEvent,preventDefaultAction:s.preventDefaultAction,preventVerticalPan:s.preventVerticalPan,preventHorizontalPan:s.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),v.preventDefaultAction||s.ctrl||s.alt||s.meta)return!0;switch(s.keyCode){case 38:return v.preventVerticalPan||(s.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return v.preventVerticalPan||(s.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function x(s){var v={originalEvent:s.originalEvent,preventDefaultAction:s.preventDefaultAction,preventVerticalPan:s.preventVerticalPan,preventHorizontalPan:s.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),v.preventDefaultAction||s.ctrl||s.alt||s.meta)return!0;switch(s.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return v.preventVerticalPan||(s.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return v.preventVerticalPan||(s.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.setRotation(e.positiveModulo(this.viewport.flipped?this.viewport.degrees-this.rotationIncrement:this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.setRotation(e.positiveModulo(this.viewport.flipped?this.viewport.degrees+this.rotationIncrement:this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function S(s){var v;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(s.position.x=this.viewport.getContainerSize().x-s.position.x);var a={tracker:s.eventSource,position:s.position,quick:s.quick,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:s.preventDefaultAction};this.raiseEvent("canvas-click",a),!a.preventDefaultAction&&this.viewport&&s.quick&&(v=this.gestureSettingsByDeviceType(s.pointerType)).clickToZoom&&(this.viewport.zoomBy(s.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints())}function P(s){var v,a={tracker:s.eventSource,position:s.position,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:s.preventDefaultAction};this.raiseEvent("canvas-double-click",a),!a.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(s.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(s.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints())}function R(s){var v,a={tracker:s.eventSource,position:s.position,delta:s.delta,speed:s.speed,direction:s.direction,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:s.preventDefaultAction};if(this.raiseEvent("canvas-drag",a),!a.preventDefaultAction&&this.viewport){if(v=this.gestureSettingsByDeviceType(s.pointerType),this.panHorizontal||(s.delta.x=0),this.panVertical||(s.delta.y=0),this.viewport.flipped&&(s.delta.x=-s.delta.x),this.constrainDuringPan){var u=this.viewport.deltaPointsFromPixels(s.delta.negate());this.viewport.centerSpringX.target.value+=u.x,this.viewport.centerSpringY.target.value+=u.y;var p=this.viewport.getBounds(),m=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=u.x,this.viewport.centerSpringY.target.value-=u.y,p.x!=m.x&&(s.delta.x=0),p.y!=m.y&&(s.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(s.delta.negate()),v.flickEnabled&&!this.constrainDuringPan)}}function I(s){if(!s.preventDefaultAction&&this.viewport){var v=this.gestureSettingsByDeviceType(s.pointerType);if(v.flickEnabled&&s.speed>=v.flickMinSpeed){var a=0;this.panHorizontal&&(a=v.flickMomentum*s.speed*Math.cos(s.direction));var u=0;this.panVertical&&(u=v.flickMomentum*s.speed*Math.sin(s.direction));var p=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),m=this.viewport.pointFromPixel(new e.Point(p.x-a,p.y-u));this.viewport.panTo(m,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:s.eventSource,position:s.position,speed:s.speed,direction:s.direction,shift:s.shift,originalEvent:s.originalEvent})}function H(s){this.raiseEvent("canvas-enter",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function j(s){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function F(s){this.raiseEvent("canvas-press",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,insideElementPressed:s.insideElementPressed,insideElementReleased:s.insideElementReleased,originalEvent:s.originalEvent})}function G(s){this.raiseEvent("canvas-release",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,insideElementPressed:s.insideElementPressed,insideElementReleased:s.insideElementReleased,originalEvent:s.originalEvent})}function K(s){this.raiseEvent("canvas-nonprimary-press",{tracker:s.eventSource,position:s.position,pointerType:s.pointerType,button:s.button,buttons:s.buttons,originalEvent:s.originalEvent})}function _(s){this.raiseEvent("canvas-nonprimary-release",{tracker:s.eventSource,position:s.position,pointerType:s.pointerType,button:s.button,buttons:s.buttons,originalEvent:s.originalEvent})}function D(s){var v,a,u;if(!s.preventDefaultAction&&this.viewport&&((v=this.gestureSettingsByDeviceType(s.pointerType)).pinchToZoom&&(a=this.viewport.pointFromPixel(s.center,!0),u=this.viewport.pointFromPixel(s.lastCenter,!0).minus(a),this.panHorizontal||(u.x=0),this.panVertical||(u.y=0),this.viewport.zoomBy(s.distance/s.lastDistance,a,!0),v.zoomToRefPoint&&this.viewport.panBy(u,!0),this.viewport.applyConstraints()),v.pinchRotate)){var p=Math.atan2(s.gesturePoints[0].currentPos.y-s.gesturePoints[1].currentPos.y,s.gesturePoints[0].currentPos.x-s.gesturePoints[1].currentPos.x),m=Math.atan2(s.gesturePoints[0].lastPos.y-s.gesturePoints[1].lastPos.y,s.gesturePoints[0].lastPos.x-s.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(p-m)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:s.eventSource,gesturePoints:s.gesturePoints,lastCenter:s.lastCenter,center:s.center,lastDistance:s.lastDistance,distance:s.distance,shift:s.shift,originalEvent:s.originalEvent}),!1}function z(s){var v,a,u;if((u=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=u,this.viewport.flipped&&(s.position.x=this.viewport.getContainerSize().x-s.position.x),!s.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(s.pointerType)).scrollToZoom&&(a=Math.pow(this.zoomPerScroll,s.scroll),this.viewport.zoomBy(a,v.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:s.eventSource,position:s.position,scroll:s.scroll,shift:s.shift,originalEvent:s.originalEvent}),v&&v.scrollToZoom)return!1}else if((v=this.gestureSettingsByDeviceType(s.pointerType))&&v.scrollToZoom)return!1}function M(s){t[this.hash].mouseInside=!0,d(this),this.raiseEvent("container-enter",{tracker:s.eventSource,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function N(s){s.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||o(this)),this.raiseEvent("container-exit",{tracker:s.eventSource,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function U(s){(function(v){if(!v._opening){if(v.autoResize){var a=n(v.container),u=t[v.hash].prevContainerSize;if(!a.equals(u)){var p=v.viewport;if(v.preserveImageSizeOnResize){var m=u.x/a.x,w=p.getZoom()*m,f=p.getCenter();p.resize(a,!1),p.zoomTo(w,null,!0),p.panTo(f,!0)}else{var O=p.getBounds();p.resize(a,!0),p.fitBoundsWithConstraints(O,!0)}t[v.hash].prevContainerSize=a,t[v.hash].forceRedraw=!0}}var k=v.viewport.update(),E=v.world.update()||k;k&&v.raiseEvent("viewport-change"),v.referenceStrip&&(E=v.referenceStrip.update(v.viewport)||E),!t[v.hash].animating&&E&&(v.raiseEvent("animation-start"),d(v)),(E||t[v.hash].forceRedraw||v.world.needsDraw())&&((L=v).imageLoader.clear(),L.drawer.clear(),L.world.draw(),L.raiseEvent("update-viewport",{}),v._drawOverlays(),v.navigator&&v.navigator.update(v.viewport),t[v.hash].forceRedraw=!1,E&&v.raiseEvent("animation")),t[v.hash].animating&&!E&&(v.raiseEvent("animation-finish"),t[v.hash].mouseInside||o(v)),t[v.hash].animating=E}var L})(s),s._updateRequestId=!!s.isOpen()&&l(s,U)}function C(s,v){return s?s+v:v}function W(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,Z(this)}function A(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,Z(this)}function q(){t[this.hash].zooming=!1}function Z(s){e.requestAnimationFrame(e.delegate(s,V))}function V(){var s,v,a;t[this.hash].zooming&&this.viewport&&(v=(s=e.now())-t[this.hash].lastZoomTime,a=Math.pow(t[this.hash].zoomFactor,v/1e3),this.viewport.zoomBy(a),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=s,Z(this))}function Y(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Q(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function oe(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function re(){this.viewport&&this.viewport.goHome()}function ne(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function J(){if(this.viewport){var s=this.viewport.getRotation();s=e.positiveModulo(this.viewport.flipped?s+this.rotationIncrement:s-this.rotationIncrement,360),this.viewport.setRotation(s)}}function ee(){if(this.viewport){var s=this.viewport.getRotation();s=e.positiveModulo(this.viewport.flipped?s-this.rotationIncrement:s+this.rotationIncrement,360),this.viewport.setRotation(s)}}function te(){this.viewport.toggleFlip()}function ae(){var s=this._sequenceIndex-1;this.navPrevNextWrap&&s<0&&(s+=this.tileSources.length),this.goToPage(s)}function le(){var s=this._sequenceIndex+1;this.navPrevNextWrap&&s>=this.tileSources.length&&(s=0),this.goToPage(s)}e.Viewer=function(s){var v,p,a=arguments,u=this;if(e.isPlainObject(s)||(s={id:a[0],xmlPath:1<a.length?a[1]:void 0,prefixUrl:2<a.length?a[2]:void 0,controls:3<a.length?a[3]:void 0,overlays:4<a.length?a[4]:void 0}),s.config&&(e.extend(!0,s,s.config),delete s.config),e.extend(!0,this,{id:s.id,hash:s.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,s),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(p){var m=e.getString("Errors.OpenFailed",p.eventSource,p.message);u._showMessage(m)}),e.ControlDock.call(this,s),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(p=this.canvas.style).width="100%",p.height="100%",p.overflow="hidden",p.position="absolute",p.top="0px",p.left="0px",e.setElementTouchActionNone(this.canvas),""!==s.tabIndex&&(this.canvas.tabIndex=void 0===s.tabIndex?0:s.tabIndex),this.container.className="openseadragon-container",function(p){p.width="100%",p.height="100%",p.position="relative",p.overflow="hidden",p.left="0px",p.top="0px",p.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,T),keyHandler:e.delegate(this,x),clickHandler:e.delegate(this,S),dblClickHandler:e.delegate(this,P),dragHandler:e.delegate(this,R),dragEndHandler:e.delegate(this,I),enterHandler:e.delegate(this,H),exitHandler:e.delegate(this,j),pressHandler:e.delegate(this,F),releaseHandler:e.delegate(this,G),nonPrimaryPressHandler:e.delegate(this,K),nonPrimaryReleaseHandler:e.delegate(this,_),scrollHandler:e.delegate(this,z),pinchHandler:e.delegate(this,D)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,M),exitHandler:e.delegate(this,N)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(p){u.source=u.world.getItemAt(0).source,t[u.hash].forceRedraw=!0,u._updateRequestId||(u._updateRequestId=l(u,U))}),this.world.addHandler("remove-item",function(p){u.source=u.world.getItemCount()?u.world.getItemAt(0).source:null,t[u.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(p){u.viewport&&u.viewport._setContentBounds(u.world.getHomeBounds(),u.world.getContentFactor())}),this.world.addHandler("item-index-change",function(p){u.source=u.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:s.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(v=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(v,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(v=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(v,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),v=0;v<this.customControls.length;v++)this.addControl(this.customControls[v].id,{anchor:this.customControls[v].anchor});e.requestAnimationFrame(function(){o(u)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(s){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(s)},openTileSource:function(s){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(s)},open:function(s,v){var a=this;if(this.close(),s)if(this.sequenceMode&&e.isArray(s))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===v||isNaN(v)||(this.initialPage=v),this.tileSources=s,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);else if(e.isArray(s)||(s=[s]),s.length){let E=function(){if(p+m===u)if(p){(a._firstOpen||!a.preserveViewport)&&(a.viewport.goHome(!0),a.viewport.update()),a._firstOpen=!1;var b=s[0];if(b.tileSource&&(b=b.tileSource),a.overlays&&!a.preserveOverlays)for(var B=0;B<a.overlays.length;B++)a.currentOverlays[B]=r(a,a.overlays[B]);a._drawOverlays(),a._opening=!1,a.raiseEvent("open",{source:b})}else a._opening=!1,a.raiseEvent("open-failed",w)},L=function(b){e.isPlainObject(b)&&b.tileSource||(b={tileSource:b}),void 0!==b.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete b.index),void 0===b.collectionImmediately&&(b.collectionImmediately=!0);var B=b.success;b.success=function(ie){if(p++,b.tileSource.overlays)for(var se=0;se<b.tileSource.overlays.length;se++)a.addOverlay(b.tileSource.overlays[se]);B&&B(ie),E()};var X=b.error;b.error=function(ie){m++,w=w||ie,X&&X(ie),E()},a.addTiledImage(b)};this._opening=!0;for(var w,u=s.length,p=0,m=0,f=0;f<s.length;f++)L(s[f]);return this}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(s){return this.innerTracker.setTracking(s),this.outerTracker.setTracking(s),this.raiseEvent("mouse-enabled",{enabled:s}),this},areControlsEnabled:function(){var s,v=this.controls.length;for(s=0;s<this.controls.length;s++)v=v&&this.controls[s].isVisible();return v},setControlsEnabled:function(s){return(s?d:o)(this),this.raiseEvent("controls-enabled",{enabled:s}),this},setDebugMode:function(s){for(var v=0;v<this.world.getItemCount();v++)this.world.getItemAt(v).debugMode=s;this.debugMode=s,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(s){var v,a,u=document.body,p=u.style,m=document.documentElement.style,w=this;if(s==this.isFullPage())return this;var f={fullPage:s,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",f),f.preventDefaultAction)return this;if(s){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=p.margin,this.docMargin=m.margin,p.margin="0",m.margin="0",this.bodyPadding=p.padding,this.docPadding=m.padding,p.padding="0",m.padding="0",this.bodyWidth=p.width,this.docWidth=m.width,p.width="100%",m.width="100%",this.bodyHeight=p.height,this.docHeight=m.height,p.height="100%",m.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,v=u.childNodes.length,a=0;a<v;a++)this.previousBody.push(u.childNodes[0]),u.removeChild(u.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,u.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),u.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,M)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,p.margin=this.bodyMargin,m.margin=this.docMargin,p.padding=this.bodyPadding,m.padding=this.docPadding,p.width=this.bodyWidth,m.width=this.docWidth,p.height=this.bodyHeight,m.height=this.docHeight,u.removeChild(this.element),v=this.previousBody.length,a=0;a<v;a++)u.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(u.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var O=0,k=function(){e.setPageScroll(w.pageScroll);var E=e.getPageScroll();++O<10&&(E.x!==w.pageScroll.x||E.y!==w.pageScroll.y)&&e.requestAnimationFrame(k)};e.requestAnimationFrame(k),t[this.hash].fullPage=!1,e.delegate(this,N)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:s}),this},setFullScreen:function(s){var v=this;if(!e.supportsFullScreen)return this.setFullPage(s);if(e.isFullScreen()===s)return this;var a={fullScreen:s,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",a),a.preventDefaultAction)return this;if(s){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var u=function(){var p=e.isFullScreen();p||(e.removeEvent(document,e.fullScreenEventName,u),e.removeEvent(document,e.fullScreenErrorEventName,u),v.setFullPage(!1),v.isFullPage()&&(v.element.style.width=v.fullPageStyleWidth,v.element.style.height=v.fullPageStyleHeight)),v.navigator&&v.viewport&&setTimeout(function(){v.navigator.update(v.viewport)}),v.raiseEvent("full-screen",{fullScreen:p})};e.addEvent(document,e.fullScreenEventName,u),e.addEvent(document,e.fullScreenErrorEventName,u),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(s){return this.container.style.visibility=s?"":"hidden",this.raiseEvent("visible",{visible:s}),this},addTiledImage:function(s){e.console.assert(s,"[Viewer.addTiledImage] options is required"),e.console.assert(s.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!s.replace||-1<s.index&&s.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var v=this;s.replace&&(s.replaceItem=v.world.getItemAt(s.index)),this._hideMessage(),void 0===s.placeholderFillStyle&&(s.placeholderFillStyle=this.placeholderFillStyle),void 0===s.opacity&&(s.opacity=this.opacity),void 0===s.preload&&(s.preload=this.preload),void 0===s.compositeOperation&&(s.compositeOperation=this.compositeOperation),void 0===s.crossOriginPolicy&&(s.crossOriginPolicy=void 0!==s.tileSource.crossOriginPolicy?s.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===s.ajaxWithCredentials&&(s.ajaxWithCredentials=this.ajaxWithCredentials),void 0===s.loadTilesWithAjax&&(s.loadTilesWithAjax=this.loadTilesWithAjax),null==s.ajaxHeaders?s.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(s.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(s.ajaxHeaders=e.extend({},this.ajaxHeaders,s.ajaxHeaders));var a={options:s};function u(w){for(var f=0;f<v._loadQueue.length;f++)if(v._loadQueue[f]===a){v._loadQueue.splice(f,1);break}0===v._loadQueue.length&&p(a),v.raiseEvent("add-item-failed",w),s.error&&s.error(w)}function p(w){v.collectionMode&&(v.world.arrange({immediately:w.options.collectionImmediately,rows:v.collectionRows,columns:v.collectionColumns,layout:v.collectionLayout,tileSize:v.collectionTileSize,tileMargin:v.collectionTileMargin}),v.world.setAutoRefigureSizes(!0))}function m(){for(var w,f,O;v._loadQueue.length&&(w=v._loadQueue[0]).tileSource;){if(v._loadQueue.splice(0,1),w.options.replace){var k=v.world.getIndexOfItem(w.options.replaceItem);-1!=k&&(w.options.index=k),v.world.removeItem(w.options.replaceItem)}f=new e.TiledImage({viewer:v,source:w.tileSource,viewport:v.viewport,drawer:v.drawer,tileCache:v.tileCache,imageLoader:v.imageLoader,x:w.options.x,y:w.options.y,width:w.options.width,height:w.options.height,fitBounds:w.options.fitBounds,fitBoundsPlacement:w.options.fitBoundsPlacement,clip:w.options.clip,placeholderFillStyle:w.options.placeholderFillStyle,opacity:w.options.opacity,preload:w.options.preload,degrees:w.options.degrees,compositeOperation:w.options.compositeOperation,springStiffness:v.springStiffness,animationTime:v.animationTime,minZoomImageRatio:v.minZoomImageRatio,wrapHorizontal:v.wrapHorizontal,wrapVertical:v.wrapVertical,immediateRender:v.immediateRender,blendTime:v.blendTime,alwaysBlend:v.alwaysBlend,minPixelRatio:v.minPixelRatio,smoothTileEdgesMinZoom:v.smoothTileEdgesMinZoom,iOSDevice:v.iOSDevice,crossOriginPolicy:w.options.crossOriginPolicy,ajaxWithCredentials:w.options.ajaxWithCredentials,loadTilesWithAjax:w.options.loadTilesWithAjax,ajaxHeaders:w.options.ajaxHeaders,debugMode:v.debugMode}),v.collectionMode&&v.world.setAutoRefigureSizes(!1),v.world.addItem(f,{index:w.options.index}),0===v._loadQueue.length&&p(w),1!==v.world.getItemCount()||v.preserveViewport||v.viewport.goHome(!0),v.navigator&&(O=e.extend({},w.options,{replace:!1,originalTiledImage:f,tileSource:w.tileSource}),v.navigator.addTiledImage(O)),w.options.success&&w.options.success({item:f})}}e.isArray(s.tileSource)?setTimeout(function(){u({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:s.tileSource,options:s})}):(this._loadQueue.push(a),function(w,f,O,k,E){var L=w;if("string"==e.type(f))if(f.match(/^\s*<.*>\s*$/))f=e.parseXml(f);else if(f.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var b=e.parseJSON(f);f=b}catch(X){}function B(X,ie){X.ready?k(X):(X.addHandler("ready",function(){k(X)}),X.addHandler("open-failed",function(se){E({message:se.message,source:ie})}))}setTimeout(function(){if("string"==e.type(f))(f=new e.TileSource({url:f,crossOriginPolicy:void 0!==O.crossOriginPolicy?O.crossOriginPolicy:w.crossOriginPolicy,ajaxWithCredentials:w.ajaxWithCredentials,ajaxHeaders:w.ajaxHeaders,useCanvas:w.useCanvas,success:function(he){k(he.tileSource)}})).addHandler("open-failed",function(he){E(he)});else if(e.isPlainObject(f)||f.nodeType)if(void 0!==f.crossOriginPolicy||void 0===O.crossOriginPolicy&&void 0===w.crossOriginPolicy||(f.crossOriginPolicy=void 0!==O.crossOriginPolicy?O.crossOriginPolicy:w.crossOriginPolicy),void 0===f.ajaxWithCredentials&&(f.ajaxWithCredentials=w.ajaxWithCredentials),void 0===f.useCanvas&&(f.useCanvas=w.useCanvas),e.isFunction(f.getTileUrl)){var X=new e.TileSource(f);X.getTileUrl=f.getTileUrl,k(X)}else{var ie=e.TileSource.determineType(L,f);if(!ie)return void E({message:"Unable to load TileSource",source:f});var se=ie.prototype.configure.apply(L,[f]);B(new ie(se),f)}else B(f,f)})}(this,s.tileSource,s,function(w){a.tileSource=w,m()},function(w){w.options=s,u(w),m()}))},addSimpleImage:function(s){e.console.assert(s,"[Viewer.addSimpleImage] options is required"),e.console.assert(s.url,"[Viewer.addSimpleImage] options.url is required");var v=e.extend({},s,{tileSource:{type:"image",url:s.url}});delete v.url,this.addTiledImage(v)},addLayer:function(s){var v=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var a=e.extend({},s,{success:function(u){v.raiseEvent("add-layer",{options:s,drawer:u.item})},error:function(u){v.raiseEvent("add-layer-failed",u)}});return this.addTiledImage(a),this},getLayerAtLevel:function(s){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(s)},getLevelOfLayer:function(s){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(s)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(s,v){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(s,v)},removeLayer:function(s){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(s)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var s=e.delegate(this,g),v=e.delegate(this,y),a=e.delegate(this,le),u=e.delegate(this,ae),p=this.navImages,m=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(m=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:C(this.prefixUrl,p.previous.REST),srcGroup:C(this.prefixUrl,p.previous.GROUP),srcHover:C(this.prefixUrl,p.previous.HOVER),srcDown:C(this.prefixUrl,p.previous.DOWN),onRelease:u,onFocus:s,onBlur:v}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:C(this.prefixUrl,p.next.REST),srcGroup:C(this.prefixUrl,p.next.GROUP),srcHover:C(this.prefixUrl,p.next.HOVER),srcDown:C(this.prefixUrl,p.next.DOWN),onRelease:a,onFocus:s,onBlur:v}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),m&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var s=e.delegate(this,W),v=e.delegate(this,q),a=e.delegate(this,Y),u=e.delegate(this,A),p=e.delegate(this,Q),m=e.delegate(this,re),w=e.delegate(this,ne),f=e.delegate(this,J),O=e.delegate(this,ee),k=e.delegate(this,te),E=e.delegate(this,g),L=e.delegate(this,y),b=this.navImages,B=[],X=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(X=!1),this.showZoomControl&&(B.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:C(this.prefixUrl,b.zoomIn.REST),srcGroup:C(this.prefixUrl,b.zoomIn.GROUP),srcHover:C(this.prefixUrl,b.zoomIn.HOVER),srcDown:C(this.prefixUrl,b.zoomIn.DOWN),onPress:s,onRelease:v,onClick:a,onEnter:s,onExit:v,onFocus:E,onBlur:L})),B.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:C(this.prefixUrl,b.zoomOut.REST),srcGroup:C(this.prefixUrl,b.zoomOut.GROUP),srcHover:C(this.prefixUrl,b.zoomOut.HOVER),srcDown:C(this.prefixUrl,b.zoomOut.DOWN),onPress:u,onRelease:v,onClick:p,onEnter:u,onExit:v,onFocus:E,onBlur:L}))),this.showHomeControl&&B.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:C(this.prefixUrl,b.home.REST),srcGroup:C(this.prefixUrl,b.home.GROUP),srcHover:C(this.prefixUrl,b.home.HOVER),srcDown:C(this.prefixUrl,b.home.DOWN),onRelease:m,onFocus:E,onBlur:L})),this.showFullPageControl&&B.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:C(this.prefixUrl,b.fullpage.REST),srcGroup:C(this.prefixUrl,b.fullpage.GROUP),srcHover:C(this.prefixUrl,b.fullpage.HOVER),srcDown:C(this.prefixUrl,b.fullpage.DOWN),onRelease:w,onFocus:E,onBlur:L})),this.showRotationControl&&(B.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:C(this.prefixUrl,b.rotateleft.REST),srcGroup:C(this.prefixUrl,b.rotateleft.GROUP),srcHover:C(this.prefixUrl,b.rotateleft.HOVER),srcDown:C(this.prefixUrl,b.rotateleft.DOWN),onRelease:f,onFocus:E,onBlur:L})),B.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:C(this.prefixUrl,b.rotateright.REST),srcGroup:C(this.prefixUrl,b.rotateright.GROUP),srcHover:C(this.prefixUrl,b.rotateright.HOVER),srcDown:C(this.prefixUrl,b.rotateright.DOWN),onRelease:O,onFocus:E,onBlur:L}))),this.showFlipControl&&B.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:C(this.prefixUrl,b.flip.REST),srcGroup:C(this.prefixUrl,b.flip.GROUP),srcHover:C(this.prefixUrl,b.flip.HOVER),srcDown:C(this.prefixUrl,b.flip.DOWN),onRelease:k,onFocus:E,onBlur:L})),X&&(this.buttons=new e.ButtonGroup({buttons:B,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,oe)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(s){return this.tileSources&&0<=s&&s<this.tileSources.length&&(this._sequenceIndex=s,this._updateSequenceButtons(s),this.open(this.tileSources[s]),this.referenceStrip&&this.referenceStrip.setFocus(s),this.raiseEvent("page",{page:s})),this},addOverlay:function(s,v,a,u){var p;if(p=e.isPlainObject(s)?s:{element:s,location:v,placement:a,onDraw:u},s=e.getElement(p.element),0<=h(this.currentOverlays,s))return this;var m=r(this,p);return this.currentOverlays.push(m),m.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:s,location:p.location,placement:p.placement}),this},updateOverlay:function(s,v,a){var u;return s=e.getElement(s),0<=(u=h(this.currentOverlays,s))&&(this.currentOverlays[u].update(v,a),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:s,location:v,placement:a})),this},removeOverlay:function(s){var v;return s=e.getElement(s),0<=(v=h(this.currentOverlays,s))&&(this.currentOverlays[v].destroy(),this.currentOverlays.splice(v,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:s})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(s){var v;return s=e.getElement(s),0<=(v=h(this.currentOverlays,s))?this.currentOverlays[v]:null},_updateSequenceButtons:function(s){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==s?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<s?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(s){this._hideMessage();var v=e.makeNeutralElement("div");v.appendChild(document.createTextNode(s)),this.messageDiv=e.makeCenteredNode(v),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var s=this.messageDiv;s&&(s.parentNode.removeChild(s),delete this.messageDiv)},gestureSettingsByDeviceType:function(s){switch(s){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var s,v=this.currentOverlays.length;for(s=0;s<v;s++)this.currentOverlays[s].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(c){var o={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:c.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",o),!o.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var d=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(d.x=this.viewer.viewport.getCenter(!0).x):d.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(d),this.viewer.viewport.applyConstraints()}}function i(c){var o={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:c.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",o),!o.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(c){return this.viewer.raiseEvent("navigator-scroll",{tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent}),!1}function h(c,o){l(c,"rotate("+o+"deg)")}function l(c,o){c.style.webkitTransform=o,c.style.mozTransform=o,c.style.msTransform=o,c.style.oTransform=o,c.style.transform=o}e.Navigator=function(c){var o,d,x,S,g=c.viewer,y=this;function T(x){h(y.displayRegionContainer,x),h(y.displayRegion,-x),y.viewport.setRotation(x)}c.id?(this.element=document.getElementById(c.id),c.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),c.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&("BOTTOM_RIGHT"==c.position?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==c.position?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==c.position?c.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==c.position?c.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==c.position&&(c.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",(c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:c.autoResize,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor})).minPixelRatio=this.minPixelRatio=g.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),c.controlOptions.anchor!=e.ControlAnchor.NONE&&(S=this.borderWidth,(x=this.element.style).margin="0px",x.border=S+"px solid "+c.borderColor,x.padding="0px",x.background=c.background,x.opacity=c.opacity,x.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(x,S){x.position="relative",x.top="0px",x.left="0px",x.fontSize="0px",x.overflow="hidden",x.border=S+"px solid "+c.displayRegionColor,x.margin="0px",x.padding="0px",x.background="transparent",x.float="left",x.cssFloat="left",x.styleFloat="left",x.zIndex=999999999,x.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",g.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!=e.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(o=e.getElementSize(g.element),this.element.style.height=Math.round(o.y*c.sizeRatio)+"px",this.element.style.width=Math.round(o.x*c.sizeRatio)+"px",this.oldViewerSize=o,d=e.getElementSize(this.element),this.elementArea=d.x*d.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),c.navigatorRotate&&(T(c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0),c.viewer.addHandler("rotate",function(x){T(x.degrees)})),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,r)}),this.addHandler("reset-size",function(){y.viewport&&y.viewport.goHome(!0)}),g.world.addHandler("item-index-change",function(x){window.setTimeout(function(){var S=y.world.getItemAt(x.previousIndex);y.world.setItemIndex(S,x.newIndex)},1)}),g.world.addHandler("remove-item",function(x){var P=y._getMatchingItem(x.item);P&&y.world.removeItem(P)}),this.update(g.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.drawer.clear(),this.world.draw())}},setWidth:function(c){this.width=c,this.element.style.width="number"==typeof c?c+"px":c,this._resizeWithViewer=!1},setHeight:function(c){this.height=c,this.element.style.height="number"==typeof c?c+"px":c,this._resizeWithViewer=!1},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){l(this.displayRegion,c),l(this.canvas,c),l(this.element,c)},update:function(c){var o,d,g,y,T,x;if(o=e.getElementSize(this.viewer.element),this._resizeWithViewer&&o.x&&o.y&&!o.equals(this.oldViewerSize)&&(this.oldViewerSize=o,this.maintainSizeRatio||!this.elementArea?(d=o.x*this.sizeRatio,g=o.y*this.sizeRatio):(d=Math.sqrt(this.elementArea*(o.x/o.y)),g=this.elementArea/d),this.element.style.width=Math.round(d)+"px",this.element.style.height=Math.round(g)+"px",this.elementArea||(this.elementArea=d*g),this.updateSize()),c&&this.viewport){y=c.getBoundsNoRotate(!0),T=this.viewport.pixelFromPointNoRotate(y.getTopLeft(),!1),x=this.viewport.pixelFromPointNoRotate(y.getBottomRight(),!1).minus(this.totalBorderWidths);var S=this.displayRegion.style;S.display=this.world.getItemCount()?"block":"none",S.top=Math.round(T.y)+"px",S.left=Math.round(T.x)+"px";var P=Math.abs(T.x-x.x),R=Math.abs(T.y-x.y);S.width=Math.round(Math.max(P,0))+"px",S.height=Math.round(Math.max(R,0))+"px"}},addTiledImage:function(c){var o=this,d=c.originalTiledImage;delete c.original;var g=e.extend({},c,{success:function(y){var T=y.item;function x(){o._matchBounds(T,d)}T._originalForNavigator=d,o._matchBounds(T,d,!0),d.addHandler("bounds-change",x),d.addHandler("clip-change",x),d.addHandler("opacity-change",function(){o._matchOpacity(T,d)}),d.addHandler("composite-operation-change",function(){o._matchCompositeOperation(T,d)})}});return e.Viewer.prototype.addTiledImage.apply(this,[g])},_getMatchingItem:function(c){for(var d,o=this.world.getItemCount(),g=0;g<o;g++)if((d=this.world.getItemAt(g))._originalForNavigator===c)return d;return null},_matchBounds:function(c,o,d){var g=o.getBoundsNoRotate();c.setPosition(g.getTopLeft(),d),c.setWidth(g.width,d),c.setRotation(o.getRotation(),d),c.setClip(o.getClip())},_matchOpacity:function(c,o){c.setOpacity(o.opacity)},_matchCompositeOperation:function(c,o){c.setCompositeOperation(o.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var n,r=i.split("."),h=null,l=arguments,c=t;for(n=0;n<r.length-1;n++)c=c[r[n]]||{};return"string"!=typeof(h=c[r[n]])&&(e.console.log("Untranslated source string:",i),h=""),h.replace(/\{\d+\}/g,function(o){var d=parseInt(o.match(/\d+/),10)+1;return d<l.length?l[d]:""})},setString:function(i,n){var r,h=i.split("."),l=t;for(r=0;r<h.length-1;r++)l[h[r]]||(l[h[r]]={}),l=l[h[r]];l[h[r]]=n}})}(OpenSeadragon),function(e){e.Point=function(t,i){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n,r;if(i=i||new e.Point(0,0),t%90==0)switch(e.positiveModulo(t,360)){case 0:n=1,r=0;break;case 90:n=0,r=1;break;case 180:n=-1,r=0;break;case 270:n=0,r=-1}else{var h=t*Math.PI/180;n=Math.cos(h),r=Math.sin(h)}return new e.Point(n*(this.x-i.x)-r*(this.y-i.y)+i.x,r*(this.x-i.x)+n*(this.y-i.y)+i.y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,n,r,h,l){var o,d,c=this,g=arguments;if(o=e.isPlainObject(t)?t:{width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]},e.EventSource.call(this),e.extend(!0,this,o),!this.success)for(d=0;d<arguments.length;d++)if(e.isFunction(arguments[d])){this.success=arguments[d];break}this.success&&this.addHandler("ready",function(y){c.success(y)}),"string"==e.type(t)&&(this.url=t),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=o.width&&o.height?o.width/o.height:1,this.dimensions=new e.Point(o.width,o.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=o.tileOverlap?o.tileOverlap:0,this.minLevel=o.minLevel?o.minLevel:0,this.maxLevel=null!=o.maxLevel?o.maxLevel:o.width&&o.height?Math.ceil(Math.log(Math.max(o.width,o.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth?this._tileWidth:this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight?this._tileHeight:this.getTileSize(t)},getLevelScale:function(t){var i,n={};for(i=0;i<=this.maxLevel;i++)n[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(r){return n[r]},this.getLevelScale(t)},getNumTiles:function(t){var i=this.getLevelScale(t),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),r=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(n,r)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t));return new e.Point(1/i.x,1/i.y)},getClosestLevel:function(){var t,i;for(t=this.minLevel+1;t<=this.maxLevel&&!(1<(i=this.getNumTiles(t)).x||1<i.y);t++);return t-1},getTileAtPoint:function(t,i){e.console.assert(0<=i.x&&i.x<=1&&0<=i.y&&i.y<=1/this.aspectRatio,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(t),l=i.y*r,c=Math.floor(i.x*r/this.getTileWidth(t)),o=Math.floor(l/this.getTileHeight(t));return 1<=i.x&&(c=this.getNumTiles(t).x-1),i.y>=1/this.aspectRatio-1e-15&&(o=this.getNumTiles(t).y-1),new e.Point(c,o)},getTileBounds:function(t,i,n,r){var h=this.dimensions.times(this.getLevelScale(t)),l=this.getTileWidth(t),c=this.getTileHeight(t),o=0===i?0:l*i-this.tileOverlap,d=0===n?0:c*n-this.tileOverlap,g=l+(0===i?1:2)*this.tileOverlap,y=c+(0===n?1:2)*this.tileOverlap,T=1/h.x;return g=Math.min(g,h.x-o),y=Math.min(y,h.y-d),r?new e.Rect(0,0,g,y):new e.Rect(o*T,d*T,g*T,y*T)},getImageInfo:function(t){var i,n,r,h,l,c,o,d=this;t&&-1<(o=(c=(l=t.split("/"))[l.length-1]).lastIndexOf("."))&&(l[l.length-1]=c.slice(0,o)),n=function(g){"string"==typeof g&&(g=e.parseXml(g));var y=e.TileSource.determineType(d,g,t);y?(void 0===(h=y.prototype.configure.apply(d,[g,t])).ajaxWithCredentials&&(h.ajaxWithCredentials=d.ajaxWithCredentials),r=new y(h),d.ready=!0,d.raiseEvent("ready",{tileSource:r})):d.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:n})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(g){var y=function(T){var S,P=T.responseText,R=T.status;if(!T)throw new Error(e.getString("Errors.Security"));if(200!==T.status&&0!==T.status)throw R=T.status,new Error(e.getString("Errors.Status",R,404==R?"Not Found":T.statusText));if(P.match(/\s*<.*/))try{S=T.responseXML&&T.responseXML.documentElement?T.responseXML:e.parseXml(P)}catch(I){S=T.responseText}else if(P.match(/\s*[\{\[].*/))try{S=e.parseJSON(P)}catch(I){S=P}else S=P;return S}(g);n(y)},error:function(g,y){var T;try{T="HTTP "+g.status+" attempting to load TileSource"}catch(x){T=(void 0!==y&&y.toString?y.toString():"Unknown error")+" attempting to load TileSource"}d.raiseEvent("open-failed",{message:T,source:t})}})},supports:function(t,i){return!1},configure:function(t,i){throw new Error("Method not implemented.")},getTileUrl:function(t,i,n){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(t,i,n){return{}},tileExists:function(t,i,n){var r=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&0<=i&&0<=n&&i<r.x&&n<r.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,n){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[r])&&e.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(t,i,n))return OpenSeadragon[r];e.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(e){function t(i,n){var r,h,l=n.Image,c=l.Url,o=l.Format,d=l.Size,g=l.DisplayRect||[],y=parseInt(d.Width,10),T=parseInt(d.Height,10),x=parseInt(l.TileSize,10),S=parseInt(l.Overlap,10),P=[];for(h=0;h<g.length;h++)r=g[h].Rect,P.push(new e.DisplayRect(parseInt(r.X,10),parseInt(r.Y,10),parseInt(r.Width,10),parseInt(r.Height,10),parseInt(r.MinLevel,10),parseInt(r.MaxLevel,10)));return e.extend(!0,{width:y,height:T,tileSize:x,tileOverlap:S,minLevel:null,maxLevel:null,tilesUrl:c,fileFormat:o,displayRects:P},n)}e.DziTileSource=function(i,n,r,h,l,c,o,d,g){var y,T,x,S;if(S=e.isPlainObject(i)?i:{width:i,height:n,tileSize:r,tileOverlap:h,tilesUrl:l,fileFormat:c,displayRects:o,minLevel:d,maxLevel:g},this._levelRects={},this.tilesUrl=S.tilesUrl,this.fileFormat=S.fileFormat,this.displayRects=S.displayRects,this.displayRects)for(y=this.displayRects.length-1;0<=y;y--)for(x=(T=this.displayRects[y]).minLevel;x<=T.maxLevel;x++)this._levelRects[x]||(this._levelRects[x]=[]),this._levelRects[x].push(T);e.TileSource.apply(this,[S])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){var r;return i.Image?r=i.Image.xmlns:i.documentElement&&("Image"!=i.documentElement.localName&&"Image"!=i.documentElement.tagName||(r=i.documentElement.namespaceURI)),-1!==(r=(r||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==r.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n){var r;return r=(e.isPlainObject(i)?t:function(h,l){if(!l||!l.documentElement)throw new Error(e.getString("Errors.Xml"));var c,o,d,g,y,T=l.documentElement,x=T.localName||T.tagName,S=l.documentElement.namespaceURI,P=null,R=[];if("Image"==x)try{if(void 0===(g=T.getElementsByTagName("Size")[0])&&(g=T.getElementsByTagNameNS(S,"Size")[0]),P={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:T.getAttribute("Url"),Format:T.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(T.getAttribute("Overlap"),10),TileSize:parseInt(T.getAttribute("TileSize"),10),Size:{Height:parseInt(g.getAttribute("Height"),10),Width:parseInt(g.getAttribute("Width"),10)}}},!e.imageFormatSupported(P.Image.Format))throw new Error(e.getString("Errors.ImageFormat",P.Image.Format.toUpperCase()));for(void 0===(c=T.getElementsByTagName("DisplayRect"))&&(c=T.getElementsByTagNameNS(S,"DisplayRect")[0]),y=0;y<c.length;y++)void 0===(d=(o=c[y]).getElementsByTagName("Rect")[0])&&(d=o.getElementsByTagNameNS(S,"Rect")[0]),R.push({Rect:{X:parseInt(d.getAttribute("X"),10),Y:parseInt(d.getAttribute("Y"),10),Width:parseInt(d.getAttribute("Width"),10),Height:parseInt(d.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return R.length&&(P.Image.DisplayRect=R),t(0,P)}catch(H){throw H instanceof Error?H:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==x)throw new Error(e.getString("Errors.Dzc"));if("Error"==x){var I=T.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(I)}}throw new Error(e.getString("Errors.Dzi"))})(this,i),n&&!r.tilesUrl&&(r.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),r.queryParams=-1!=n.search(/\.(dzi|xml|js)\?/)?n.match(/\?.*/):""),r},getTileUrl:function(i,n,r){return[this.tilesUrl,i,"/",n,"_",r,".",this.fileFormat,this.queryParams].join("")},tileExists:function(i,n,r){var h,l,c,o,d,g,y,T=this._levelRects[i];if(this.minLevel&&i<this.minLevel||this.maxLevel&&i>this.maxLevel)return!1;if(!T||!T.length)return!0;for(y=T.length-1;0<=y;y--)if(!(i<(h=T[y]).minLevel||i>h.maxLevel)&&(l=this.getLevelScale(i),d=(c=h.x*l)+h.width*l,g=(o=h.y*l)+h.height*l,c=Math.floor(c/this._tileWidth),o=Math.floor(o/this._tileWidth),d=Math.ceil(d/this._tileWidth),g=Math.ceil(g/this._tileWidth),c<=n&&n<d&&o<=r&&r<g))return!0;return!1}})}(OpenSeadragon),function(e){function t(n){var r=Array.isArray(n.profile)?n.profile[0]:n.profile,h=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(r),l=!1;return 2===n.version&&1<n.profile.length&&n.profile[1].supports&&(l=-1!==n.profile[1].supports.indexOf("sizeByW")),3===n.version&&n.extraFeatures&&(l=-1!==n.extraFeatures.indexOf("sizeByWh")),!h||l}function i(n){for(var r=[],h=0;h<n.sizes.length;h++)r.push({url:n["@id"]+"/full/"+n.sizes[h].width+","+(3===n.version?n.sizes[h].height:"")+"/0/default."+n.tileFormat,width:n.sizes[h].width,height:n.sizes[h].height});return r.sort(function(l,c){return l.width-c.width})}e.IIIFTileSource=function(n){if(e.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var h=0;h<this.tiles[r].scaleFactors.length;h++){var l=this.tiles[r].scaleFactors[h];this.scale_factors.push(l),n.tileSizePerScaleFactor[l]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}else if(t(n)){for(var c=Math.min(this.height,this.width),o=[256,512,1024],d=[],g=0;g<o.length;g++)o[g]<=c&&d.push(o[g]);n.tileSize=0<d.length?Math.max.apply(null,d):c}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),e.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!n.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var y=Math.max.apply(null,this.scale_factors);n.maxLevel=Math.round(Math.log(y)*Math.LOG2E)}else n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[n])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(n,r){return!!(n.protocol&&"http://iiif.io/api/image"==n.protocol||n["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==n["@context"]||"http://iiif.io/api/image/1/context.json"==n["@context"])||n.profile&&0===n.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||n.identifier&&n.width&&n.height||n.documentElement&&"info"==n.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==n.documentElement.namespaceURI)},configure:function(n,r){if(e.isPlainObject(n)){if(n["@context"]){var h=n["@context"];if(Array.isArray(h))for(var l=0;l<h.length;l++)if("string"==typeof h[l]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(h[l])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===h[l])){h=h[l];break}switch(h){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":n.version=1;break;case"http://iiif.io/api/image/2/context.json":n.version=2;break;case"http://iiif.io/api/image/3/context.json":n.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else n["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=r.replace("/info.json",""),n.version=1;if(!n["@id"]&&n.id&&(n["@id"]=n.id),n.preferredFormats)for(var c=0;c<n.preferredFormats.length;c++)if(OpenSeadragon.imageFormatSupported(n.preferredFormats[c])){n.tileFormat=n.preferredFormats[c];break}return n}var o=function(d){if(!d||!d.documentElement)throw new Error(e.getString("Errors.Xml"));var g=d.documentElement,T=null;if("info"==g.tagName)try{return function x(S,P,R){var I,H;if(3==S.nodeType&&R)(H=S.nodeValue.trim()).match(/^\d*$/)&&(H=Number(H)),P[R]?(e.isArray(P[R])||(P[R]=[P[R]]),P[R].push(H)):P[R]=H;else if(1==S.nodeType)for(I=0;I<S.childNodes.length;I++)x(S.childNodes[I],P,S.nodeName)}(g,T={}),T}catch(x){throw x instanceof Error?x:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(n);return o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=r.replace("/info.xml",""),o.version=1,o},getTileWidth:function(n){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,n);var r=Math.pow(2,this.maxLevel-n);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].width:this._tileWidth},getTileHeight:function(n){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,n);var r=Math.pow(2,this.maxLevel-n);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].height:this._tileHeight},getLevelScale:function(n){if(this.emulateLegacyImagePyramid){var r=NaN;return 0<this.levels.length&&n>=this.minLevel&&n<=this.maxLevel&&(r=this.levels[n].width/this.levels[this.maxLevel].width),r}return e.TileSource.prototype.getLevelScale.call(this,n)},getNumTiles:function(n){return this.emulateLegacyImagePyramid?this.getLevelScale(n)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,n)},getTileAtPoint:function(n,r){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,n,r)},getTileUrl:function(n,r,h){if(this.emulateLegacyImagePyramid){var l=null;return 0<this.levels.length&&n>=this.minLevel&&n<=this.maxLevel&&(l=this.levels[n].url),l}var c,o,d,g,y,T,x,S,P,R,I,H,j,F=Math.pow(.5,this.maxLevel-n),G=Math.ceil(this.width*F),K=Math.ceil(this.height*F);return c=this.getTileWidth(n),o=this.getTileHeight(n),d=Math.ceil(c/F),g=Math.ceil(o/F),j=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,G<c&&K<o?(R=2===this.version&&G===this.width||3===this.version&&G===this.width&&K===this.height?"max":3===this.version?G+","+K:G+",",y="full"):(T=r*d,x=h*g,S=Math.min(d,this.width-T),P=Math.min(g,this.height-x),y=0===r&&0===h&&S===this.width&&P===this.height?"full":[T,x,S,P].join(","),I=Math.ceil(S*F),H=Math.ceil(P*F),R=2===this.version&&I===this.width||3===this.version&&I===this.width&&H===this.height?"max":3===this.version?I+","+H:I+","),[this["@id"],y,R,"0",j].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,n,r,h){var l;(!(l=e.isPlainObject(t)?t:{width:t,height:i,tileSize:n,tileOverlap:r,tilesUrl:h}).width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,e.TileSource.apply(this,[l])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"openstreetmaps"==t.type},configure:function(t,i){return t},getTileUrl:function(t,i,n){return this.tilesUrl+(t-8)+"/"+i+"/"+n+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,n,r,h){var l;l=e.isPlainObject(t)?t:{width:t,height:i,tileSize:n,tileOverlap:r,tilesUrl:h};var o=256*Math.ceil(l.width/256),d=256*Math.ceil(l.height/256);l.maxLevel=Math.ceil(Math.log(d<o?o/256:d/256)/Math.log(2))-1,l.tileSize=256,l.width=o,l.height=d,e.TileSource.apply(this,[l])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"tiledmapservice"==t.type},configure:function(t,i){return t},getTileUrl:function(t,i,n){var r=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+i+"/"+(r-n)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(t){t.tileSize=256;var i={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(i.x,10)>t.tileSize||parseInt(i.y,10)>t.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),t.imageSizes.push({x:i.x,y:i.y}),t.gridSize.push(this._getGridSize(i.x,i.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(t,i,n){return{x:Math.ceil(t/n),y:Math.ceil(i/n)}},_calculateAbsoluteTileNumber:function(t,i,n){for(var r=0,h={},l=0;l<t;l++)r+=(h=this.gridSize[l]).x*h.y;return r+((h=this.gridSize[t]).x*n+i)},supports:function(t,i){return t.type&&"zoomifytileservice"==t.type},configure:function(t,i){return t},getTileUrl:function(t,i,n){var r,h=this._calculateAbsoluteTileNumber(t,i,n);return r=Math.floor(h/256),this.tilesUrl+"TileGroup"+r+"/"+t+"-"+i+"-"+n+".jpg"}})}(OpenSeadragon),function(e){function t(i,n){return n.levels}e.LegacyTileSource=function(i){var n,r,h;e.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=function(l){var c,o,d=[];for(o=0;o<l.length;o++)(c=l[o]).height&&c.width&&c.url?d.push({url:c.url,width:Number(c.width),height:Number(c.height)}):e.console.error("Unsupported image format: %s",c.url?c.url:"<no URL>");return d.sort(function(g,y){return g.height-y.height})}(n.levels),0<n.levels.length?(r=n.levels[n.levels.length-1].width,h=n.levels[n.levels.length-1].height):(h=r=0,e.console.error("No supported image formats found")),e.extend(!0,n,{width:r,height:h,tileSize:Math.max(h,r),tileOverlap:0,minLevel:0,maxLevel:0<n.levels.length?n.levels.length-1:0}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&"legacy-image-pyramid"==i.type||i.documentElement&&"legacy-image-pyramid"==i.documentElement.getAttribute("type")},configure:function(i,n){return(e.isPlainObject(i)?t:function(r,h){if(!h||!h.documentElement)throw new Error(e.getString("Errors.Xml"));var l,c,o=h.documentElement,d=o.tagName,g=null,y=[];if("image"==d)try{for(g={type:o.getAttribute("type"),levels:[]},y=o.getElementsByTagName("level"),c=0;c<y.length;c++)g.levels.push({url:(l=y[c]).getAttribute("url"),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10)});return t(0,g)}catch(T){throw T instanceof Error?T:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==d)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==d)throw new Error("Error: "+h)}throw new Error("Unknown element "+d)})(this,i)},getLevelScale:function(i){var n=NaN;return 0<this.levels.length&&i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){return this.getLevelScale(i)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,n,r){var h=null;return 0<this.levels.length&&i>=this.minLevel&&i<=this.maxLevel&&(h=this.levels[i].url),h}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"image"===t.type},configure:function(t,i){return t},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),i.src=t},getLevelScale:function(t){var i=NaN;return t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,n){var r=null;return t>=this.minLevel&&t<=this.maxLevel&&(r=this.levels[t].url),r},getContext2D:function(t,i,n){var r=null;return t>=this.minLevel&&t<=this.maxLevel&&(r=this.levels[t].context2D),r},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),h=r.getContext("2d");if(r.width=i,r.height=n,h.drawImage(this._image,0,0,i,n),t[0].context2D=h,delete this._image,e.isCanvasTainted(r))return t;for(;2<=i&&2<=n;){i=Math.floor(i/2),n=Math.floor(n/2);var l=document.createElement("canvas"),c=l.getContext("2d");l.width=i,l.height=n,c.drawImage(r,0,0,i,n),t.splice(0,0,{context2D:c,width:i,height:n}),r=l,h=c}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,n,r){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(r){e.requestAnimationFrame(function(){var h,o;(h=r).shouldFade&&(o=1-(e.now()-h.fadeBeginTime)/h.fadeLength,o=Math.min(1,o),o=Math.max(0,o),h.imgGroup&&e.setElementOpacity(h.imgGroup,o,!0),0<o&&t(h))})}function i(r,h){var l;r.element.disabled||(h>=e.ButtonState.GROUP&&r.currentState==e.ButtonState.REST&&((l=r).shouldFade=!1,l.imgGroup&&e.setElementOpacity(l.imgGroup,1,!0),r.currentState=e.ButtonState.GROUP),h>=e.ButtonState.HOVER&&r.currentState==e.ButtonState.GROUP&&(r.imgHover&&(r.imgHover.style.visibility=""),r.currentState=e.ButtonState.HOVER),h>=e.ButtonState.DOWN&&r.currentState==e.ButtonState.HOVER&&(r.imgDown&&(r.imgDown.style.visibility=""),r.currentState=e.ButtonState.DOWN))}function n(r,h){var l;r.element.disabled||(h<=e.ButtonState.HOVER&&r.currentState==e.ButtonState.DOWN&&(r.imgDown&&(r.imgDown.style.visibility="hidden"),r.currentState=e.ButtonState.HOVER),h<=e.ButtonState.GROUP&&r.currentState==e.ButtonState.HOVER&&(r.imgHover&&(r.imgHover.style.visibility="hidden"),r.currentState=e.ButtonState.GROUP),h<=e.ButtonState.REST&&r.currentState==e.ButtonState.GROUP&&((l=r).shouldFade=!0,l.fadeBeginTime=e.now()+l.fadeDelay,window.setTimeout(function(){t(l)},l.fadeDelay),r.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(r){var h=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},r),this.element=r.element||e.makeNeutralElement("div"),r.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(l){l.insideElementPressed?(i(h,e.ButtonState.DOWN),h.raiseEvent("enter",{originalEvent:l.originalEvent})):l.buttonDownAny||i(h,e.ButtonState.HOVER)},focusHandler:function(l){this.enterHandler(l),h.raiseEvent("focus",{originalEvent:l.originalEvent})},exitHandler:function(l){n(h,e.ButtonState.GROUP),l.insideElementPressed&&h.raiseEvent("exit",{originalEvent:l.originalEvent})},blurHandler:function(l){this.exitHandler(l),h.raiseEvent("blur",{originalEvent:l.originalEvent})},pressHandler:function(l){i(h,e.ButtonState.DOWN),h.raiseEvent("press",{originalEvent:l.originalEvent})},releaseHandler:function(l){l.insideElementPressed&&l.insideElementReleased?(n(h,e.ButtonState.HOVER),h.raiseEvent("release",{originalEvent:l.originalEvent})):l.insideElementPressed?n(h,e.ButtonState.GROUP):i(h,e.ButtonState.HOVER)},clickHandler:function(l){l.quick&&h.raiseEvent("click",{originalEvent:l.originalEvent})},keyHandler:function(l){return 13!==l.keyCode||(h.raiseEvent("click",{originalEvent:l.originalEvent}),h.raiseEvent("release",{originalEvent:l.originalEvent}),!1)}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),r=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(h){var l;for(l=0;l<r.buttons.length;l++)r.buttons[l].notifyGroupEnter()},exitHandler:function(h){var l;if(!h.insideElementPressed)for(l=0;l<r.buttons.length;l++)r.buttons[l].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,i,n,r,h){var l,c;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof h?h:0,this.degrees=e.positiveModulo(this.degrees,360),270<=this.degrees?(l=this.getTopRight(),this.x=l.x,this.y=l.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):180<=this.degrees?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):90<=this.degrees&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var r=t.distanceTo(i),h=t.distanceTo(n),l=i.minus(t),c=Math.atan(l.y/l.x);return l.x<0?c+=Math.PI:l.y<0&&(c+=2*Math.PI),new e.Rect(t.x,t.y,r,h,c/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),r=Math.min(i.x,n.x),h=Math.min(i.y,n.y),l=Math.max(i.x+i.width,n.x+n.width),c=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(r,h,l-r,c-h)},intersection:function(t){var i=1e-10,n=[],r=this.getTopLeft();t.containsPoint(r,i)&&n.push(r);var h=this.getTopRight();t.containsPoint(h,i)&&n.push(h);var l=this.getBottomLeft();t.containsPoint(l,i)&&n.push(l);var c=this.getBottomRight();t.containsPoint(c,i)&&n.push(c);var o=t.getTopLeft();this.containsPoint(o,i)&&n.push(o);var d=t.getTopRight();this.containsPoint(d,i)&&n.push(d);var g=t.getBottomLeft();this.containsPoint(g,i)&&n.push(g);var y=t.getBottomRight();this.containsPoint(y,i)&&n.push(y);for(var T=this._getSegments(),x=t._getSegments(),S=0;S<T.length;S++)for(var P=T[S],R=0;R<x.length;R++){var I=x[R],H=j(P[0],P[1],I[0],I[1]);H&&n.push(H)}function j(M,N,U,C){var W=N.minus(M),A=C.minus(U),q=-A.x*W.y+W.x*A.y;if(0==q)return null;var Z=(W.x*(M.y-U.y)-W.y*(M.x-U.x))/q,V=(A.x*(M.y-U.y)-A.y*(M.x-U.x))/q;return-i<=Z&&Z<=1-i&&-i<=V&&V<=1-i?new e.Point(M.x+V*W.x,M.y+V*W.y):null}if(0===n.length)return null;for(var F=n[0].x,G=n[0].x,K=n[0].y,_=n[0].y,D=1;D<n.length;D++){var z=n[D];z.x<F&&(F=z.x),z.x>G&&(G=z.x),z.y<K&&(K=z.y),z.y>_&&(_=z.y)}return new e.Rect(F,K,G-F,_-K)},_getSegments:function(){var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),r=this.getBottomRight();return[[t,i],[i,r],[r,n],[n,t]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),r=this.getTopRight().rotate(t,i).minus(n);r=r.apply(function(l){return Math.abs(l)<1e-15?0:l});var h=Math.atan(r.y/r.x);return r.x<0?h+=Math.PI:r.y<0&&(h+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,h/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),r=this.getBottomRight(),h=Math.min(t.x,i.x,n.x,r.x),l=Math.max(t.x,i.x,n.x,r.x),c=Math.min(t.y,i.y,n.y,r.y),o=Math.max(t.y,i.y,n.y,r.y);return new e.Rect(h,c,l-h,o-c)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),r=Math.ceil(t.width+t.x-i),h=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,r,h)},containsPoint:function(t,i){i=i||0;var n=this.getTopLeft(),r=this.getTopRight(),h=this.getBottomLeft(),l=r.minus(n),c=h.minus(n);return(t.x-n.x)*l.x+(t.y-n.y)*l.y>=-i&&(t.x-r.x)*l.x+(t.y-r.y)*l.y<=i&&(t.x-n.x)*c.x+(t.y-n.y)*c.y>=-i&&(t.x-h.x)*c.x+(t.y-h.y)*c.y<=i},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(d){var g=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),x=Number(this.element.style.height.replace("px","")),S=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-d.delta.x?g>-(T-S.x)&&(this.element.style.marginLeft=g+2*d.delta.x+"px",r(this,S.x,g+2*d.delta.x)):-d.delta.x<0&&g<0&&(this.element.style.marginLeft=g+2*d.delta.x+"px",r(this,S.x,g+2*d.delta.x)):0<-d.delta.y?y>-(x-S.y)&&(this.element.style.marginTop=y+2*d.delta.y+"px",r(this,S.y,y+2*d.delta.y)):-d.delta.y<0&&y<0&&(this.element.style.marginTop=y+2*d.delta.y+"px",r(this,S.y,y+2*d.delta.y))),!1}function n(d){var g=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),x=Number(this.element.style.height.replace("px","")),S=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<d.scroll?g>-(T-S.x)&&(this.element.style.marginLeft=g-60*d.scroll+"px",r(this,S.x,g-60*d.scroll)):d.scroll<0&&g<0&&(this.element.style.marginLeft=g-60*d.scroll+"px",r(this,S.x,g-60*d.scroll)):d.scroll<0?y>S.y-x&&(this.element.style.marginTop=y+60*d.scroll+"px",r(this,S.y,y+60*d.scroll)):0<d.scroll&&y<0&&(this.element.style.marginTop=y+60*d.scroll+"px",r(this,S.y,y+60*d.scroll))),!1}function r(d,g,y){var T,x,S,P,R,I,H;for(T="horizontal"==d.scroll?d.panelWidth:d.panelHeight,x=Math.ceil(g/T)+5,I=x=(x=(S=Math.ceil((Math.abs(y)+g)/T)+1)-x)<0?0:x;I<S&&I<d.panels.length;I++)if(!(H=d.panels[I]).activePanel){var F=d.viewer.tileSources[I];(P=new e.Viewer({id:H.id,tileSources:[F.referenceStripThumbnailUrl?{type:"image",url:F.referenceStripThumbnailUrl}:F],element:H,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,useCanvas:d.useCanvas})).displayRegion=e.makeNeutralElement("div"),P.displayRegion.id=H.id+"-displayregion",P.displayRegion.className="displayregion",(R=P.displayRegion.style).position="relative",R.top="0px",R.left="0px",R.fontSize="0px",R.overflow="hidden",R.float="left",R.cssFloat="left",R.styleFloat="left",R.zIndex=999999999,R.cursor="default",R.width=d.panelWidth-4+"px",R.height=d.panelHeight-4+"px",P.displayRegion.innerTracker=new e.MouseTracker({element:P.displayRegion,startDisabled:!0}),H.getElementsByTagName("div")[0].appendChild(P.displayRegion),d.miniViewers[H.id]=P,H.activePanel=!0}}function h(d){var g=d.eventSource.element;return"horizontal"==this.scroll?g.style.marginBottom="0px":g.style.marginLeft="0px",!1}function l(d){var g=d.eventSource.element;return"horizontal"==this.scroll?g.style.marginBottom="-"+e.getElementSize(g).y/2+"px":g.style.marginLeft="-"+e.getElementSize(g).x/2+"px",!1}function c(d){if(d.preventDefaultAction||d.ctrl||d.alt||d.meta)return!0;switch(d.keyCode){case 38:case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}function o(d){if(d.preventDefaultAction||d.ctrl||d.alt||d.meta)return!0;switch(d.keyCode){case 61:case 48:case 119:case 87:case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(d){var g,y,T,x=d.viewer,S=e.getElementSize(x.element);for(d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,d),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(y=this.element.style).marginTop="0px",y.marginRight="0px",y.marginBottom="0px",y.marginLeft="0px",y.left="0px",y.bottom="0px",y.border="0px",y.background="#000",y.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=x,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,h),exitHandler:e.delegate(this,l),keyDownHandler:e.delegate(this,c),keyHandler:e.delegate(this,o)}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==d.scroll?(this.element.style.width=S.x*d.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.height=S.y*d.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=S.y*d.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.width=S.x*d.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=S.x*this.sizeRatio+8,this.panelHeight=S.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<x.tileSources.length;T++)(g=e.makeNeutralElement("div")).id=this.element.id+"-"+T,g.style.width=this.panelWidth+"px",g.style.height=this.panelHeight+"px",g.style.display="inline",g.style.float="left",g.style.cssFloat="left",g.style.styleFloat="left",g.style.padding="2px",e.setElementTouchActionNone(g),g.innerTracker=new e.MouseTracker({element:g,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(P){P.eventSource.dragging=e.now()},releaseHandler:function(P){var R=P.eventSource,H=Number(R.element.id.split("-")[2]),j=e.now();P.insideElementPressed&&P.insideElementReleased&&R.dragging&&j-R.dragging<R.clickTimeThreshold&&(R.dragging=null,x.goToPage(H))}}),this.element.appendChild(g),g.activePanel=!1,this.panels.push(g);r(this,"vertical"==this.scroll?S.y:S.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(d){var g,y=this.element.querySelector("#"+this.element.id+"-"+d),T=e.getElementSize(this.viewer.canvas),x=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),P=-Number(this.element.style.marginLeft.replace("px","")),R=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==y&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=y,this.currentSelected.style.background="#999","horizontal"==this.scroll?(g=Number(d)*(this.panelWidth+3))>P+T.x-this.panelWidth?(g=Math.min(g,x-T.x),this.element.style.marginLeft=-g+"px",r(this,T.x,-g)):g<P&&(g=Math.max(0,g-T.x/2),this.element.style.marginLeft=-g+"px",r(this,T.x,-g)):(g=Number(d)*(this.panelHeight+3))>R+T.y-this.panelHeight?(g=Math.min(g,S-T.y),this.element.style.marginTop=-g+"px",r(this,T.y,-g)):g<R&&(g=Math.max(0,g-T.y/2),this.element.style.marginTop=-g+"px",r(this,T.y,-g)),this.currentPage=d,h.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,r,h,l){e.Rect.apply(this,[t,i,n,r]),this.minLevel=h,this.maxLevel=l},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:1<i.length?i[1].springStiffness:5,animationTime:1<i.length?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&0<=t.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var r,n=this.current.time>=this.target.time?i:t+(i-t)*(r=this.springStiffness,(1-Math.exp(r*(-(this.current.time-this.start.time)/(this.target.time-this.start.time))))/(1-Math.exp(-r))),l=this.current.value;return this.current.value=this._exponential?Math.exp(n):n,l!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(i){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},i),this.image=null}t.prototype={errorMsg:null,start:function(){var i=this,n=this.abort;this.image=new Image,this.image.onload=function(){i.finish(!0)},this.image.onabort=this.image.onerror=function(){i.errorMsg="Image load aborted",i.finish(!1)},this.jobId=window.setTimeout(function(){i.errorMsg="Image load exceeded timeout ("+i.timeout+" ms)",i.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(r){var h;try{h=new window.Blob([r.response])}catch(d){var l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===d.name&&l){var c=new l;c.append(r.response),h=c.getBlob()}}0===h.size&&(i.errorMsg="Empty image response.",i.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(h);i.image.src=o},error:function(r){i.errorMsg="Image load aborted - XHR error",i.finish(!1)}}),this.abort=function(){i.request.abort(),"function"==typeof n&&n()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(i){this.image.onload=this.image.onerror=this.image.onabort=null,i||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(i){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},i)},e.ImageLoader.prototype={addJob:function(i){var n=this,r=new t({src:i.src,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.loadWithAjax?i.ajaxHeaders:null,crossOriginPolicy:i.crossOriginPolicy,ajaxWithCredentials:i.ajaxWithCredentials,callback:function(h){var l,c,o;c=h,o=i.callback,(l=n).jobsInProgress--,(!l.jobLimit||l.jobsInProgress<l.jobLimit)&&0<l.jobQueue.length&&(l.jobQueue.shift().start(),l.jobsInProgress++),o(c.image,c.errorMsg,c.request)},abort:i.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(r.start(),this.jobsInProgress++):this.jobQueue.push(r)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var n=this.jobQueue[i];"function"==typeof n.abort&&n.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(t,i,n,r,h,l,c,o,d,g){this.level=t,this.x=i,this.y=n,this.bounds=r,this.sourceBounds=g,this.exists=h,this.url=l,this.context2D=c,this.loadWithAjax=o,this.ajaxHeaders=d,this.cacheKey=this.ajaxHeaders?this.url+"+"+JSON.stringify(this.ajaxHeaders):this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,n,r){var h,l=this.position.times(e.pixelDensityRatio),c=this.size.times(e.pixelDensityRatio);if(this.context2D||this.cacheImageRecord)if(h=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&h){var o,d;t.save(),t.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(l=l.times(n),c=c.times(n)),r instanceof e.Point&&(l=l.plus(r)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,c.x,c.y),i({context:t,tile:this,rendered:h}),this.sourceBounds?(o=Math.min(this.sourceBounds.width,h.canvas.width),d=Math.min(this.sourceBounds.height,h.canvas.height)):(o=h.canvas.width,d=h.canvas.height),t.drawImage(h.canvas,0,0,o,d,l.x,l.y,c.x,c.y),t.restore()}else e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());else e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var r=Math.max(1,Math.ceil((n.x-i.x)/2)),h=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(r,h).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var r;r=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=r.element,this.style=r.element.style,this._init(r)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),r=e.getCssPropertyWithVendorPrefix("transform");n&&r&&(i[n]="",i[r]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var r=this._getOverlayPositionAndSize(i),h=r.position,l=this.size=r.size,c=r.rotate;if(this.onDraw)this.onDraw(h,l,this.element);else{var o=this.style;o.left=h.x+"px",o.top=h.y+"px",null!==this.width&&(o.width=l.x+"px"),null!==this.height&&(o.height=l.y+"px");var d=e.getCssPropertyWithVendorPrefix("transformOrigin"),g=e.getCssPropertyWithVendorPrefix("transform");d&&g&&(c?(o[d]=this._getTransformOrigin(),o[g]="rotate("+c+"deg)"):(o[d]="",o[g]="")),"none"!==o.display&&(o.display="block")}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var r=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var h=new e.Rect(i.x,i.y,n.x,n.y),l=this._getBoundingBox(h,t.degrees);i=l.getTopLeft(),n=l.getSize()}else r=t.degrees;return{position:i,size:n,rotate:r}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var r=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=r.x),null!==this.height&&(n=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var h=this.size=e.getElementSize(this.element);null===this.width&&(i=h.x),null===this.height&&(n=h.y)}return new e.Point(i,n)},_getBoundingBox:function(t,i){var n=this._getPlacementPoint(t);return t.rotate(i,n).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i&&(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom")),t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var r=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=r.x),null===n&&(n=r.y)}var h=this.location.clone();return this.adjust(h,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(h.x,h.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode!==e.OverlayRotationMode.BOUNDING_BOX)return i.rotate(-t.degrees,this._getPlacementPoint(i));if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,n,r){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,r),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(t,i){if(this.useCanvas){var n=this._getContext(i);n.beginPath(),t.forEach(function(r){r.forEach(function(h,l){n[0===l?"moveTo":"lineTo"](h.x,h.y)})}),n.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var r=t.getItemAt(n).getOpacity();i<r&&(i=r)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();if((this.canvas.width!=t.x||this.canvas.height!=t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var i=this._calculateSketchCanvasSize();this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(t,i){if(this.useCanvas){var n=this._getContext(t);if(i)n.clearRect(i.x,i.y,i.width,i.height);else{var r=n.canvas;n.clearRect(0,0,r.width,r.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,r,h){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var l=this._getContext(n);t.drawCanvas(l,i,r=r||1,h)}else t.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var r=this;this.viewer.addHandler("rotate",function h(){if(0!==r.viewport.getRotation()){r.viewer.removeHandler("rotate",h);var l=r._calculateSketchCanvasSize();r.sketchCanvas.width=l.x,r.sketchCanvas.height=l.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,i){if(this.useCanvas){var n=this._getContext(i);n.beginPath(),n.rect(t.x,t.y,t.width,t.height),n.clip()}},drawRectangle:function(t,i,n){if(this.useCanvas){var r=this._getContext(n);r.save(),r.fillStyle=i,r.fillRect(t.x,t.y,t.width,t.height),r.restore()}},blendSketch:function(t,i,n,r){var h=t;if(e.isPlainObject(h)||(h={opacity:t,scale:i,translate:n,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){t=h.opacity,r=h.compositeOperation;var l=h.bounds;if(this.context.save(),this.context.globalAlpha=t,r&&(this.context.globalCompositeOperation=r),l)l.x<0&&(l.width+=l.x,l.x=0),l.x+l.width>this.canvas.width&&(l.width=this.canvas.width-l.x),l.y<0&&(l.height+=l.y,l.y=0),l.y+l.height>this.canvas.height&&(l.height=this.canvas.height-l.y),this.context.drawImage(this.sketchCanvas,l.x,l.y,l.width,l.height,l.x,l.y,l.width,l.height);else{i=h.scale||1;var c=(n=h.translate)instanceof e.Point?n:new e.Point(0,0),o=0,d=0;if(n){var y=this.sketchCanvas.height-this.canvas.height;o=Math.round((this.sketchCanvas.width-this.canvas.width)/2),d=Math.round(y/2)}this.context.drawImage(this.sketchCanvas,c.x-o*i,c.y-d*i,(this.canvas.width+2*o)*i,(this.canvas.height+2*d)*i,-o,-d,this.canvas.width+2*o,this.canvas.height+2*d)}this.context.restore()}},drawDebugInfo:function(t,i,n,r){if(this.useCanvas){var h=this.viewer.world.getIndexOfItem(r)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*e.pixelDensityRatio,l.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[h],l.fillStyle=this.debugGridColor[h],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:r.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0)}),0===r.viewport.degrees&&r.getRotation(!0)%360==0&&r._drawer.viewer.viewport.getFlip()&&r._drawer._flip(),l.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var c=(t.position.x+t.size.x/2)*e.pixelDensityRatio,o=(t.position.y+t.size.y/2)*e.pixelDensityRatio;l.translate(c,o),l.rotate(Math.PI/180*-this.viewport.degrees),l.translate(-c,-o),0===t.x&&0===t.y&&(l.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),l.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),l.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),l.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),l.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),l.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),l.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),r.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===r.viewport.degrees&&r.getRotation(!0)%360==0&&r._drawer.viewer.viewport.getFlip()&&r._drawer._flip(),l.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(t){this.useCanvas&&(this._imageSmoothingEnabled=t,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(t){t.msImageSmoothingEnabled=this._imageSmoothingEnabled,t.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-t.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();if(0===this.viewport.getRotation())return t;var i=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y));return{x:i,y:i}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(0<t.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(0<t.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(0<t.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(0<t.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=t?t:1:1<=t?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),r=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-r/2,n,r)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var i=this.getBoundsNoRotate(t),n=this._containerInnerSize.x*this.getZoom(t);return i.x-=this._margins.left/n,i.y-=this._margins.top/n,i.width+=(this._margins.left+this._margins.right)/n,i.height+=(this._margins.top+this._margins.bottom)/n,i},getCenter:function(t){var i,n,r,h,l,c,o=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),d=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?o:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),h=(r=1/(n=this.getZoom()))/this.getAspectRatio(),l=new e.Rect(o.x-r/2,o.y-h/2,r,h),c=this._pixelFromPoint(this.zoomPoint,l).minus(i).divide(this._containerInnerSize.x*n),d.plus(c)):d},getZoom:function(t){return t?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(!this.wrapHorizontal){var n=this.visibilityRatio*i.width,l=this._contentBoundsNoRotate.x-(i.x+i.width)+n,c=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(l+c)/2:c<0?i.x+=c:0<l&&(i.x+=l)}if(!this.wrapVertical){var o=this.visibilityRatio*i.height,y=this._contentBoundsNoRotate.y-(i.y+i.height)+o,T=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height-i.y-o;o>this._contentBoundsNoRotate.height?i.y+=(y+T)/2:T<0?i.y+=T:0<y&&(i.y+=y)}return i},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var i=this.getZoom(),n=this._applyZoomConstraints(i);i!==n&&this.zoomTo(n,this.zoomPoint,t);var r=this.getBoundsNoRotate(),h=this._applyBoundaryConstraints(r);return this._raiseConstraintsEvent(t),r.x===h.x&&r.y===h.y&&!t||this.fitBounds(h.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(t,i){var n=(i=i||{}).immediately||!1,r=i.constraints||!1,h=this.getAspectRatio(),l=t.getCenter(),c=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=h?c.height=c.width/h:c.width=c.height*h,c.x=l.x-c.width/2,c.y=l.y-c.height/2;var o=1/c.width;if(r){var d=c.getAspectRatio(),g=this._applyZoomConstraints(o);o!==g&&(c.width=1/(o=g),c.x=l.x-c.width/2,c.height=c.width/d,c.y=l.y-c.height/2),l=(c=this._applyBoundaryConstraints(c)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(l,!0),this.zoomTo(o,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var y=this.getBounds(),T=this.getZoom();if(0===T||Math.abs(o/T-1)<1e-8)return this.zoomTo(o,!0),this.panTo(l,n);var x=(c=c.rotate(-this.getRotation())).getTopLeft().times(o).minus(y.getTopLeft().times(T)).divide(o-T);return this.zoomTo(o,x,n)},fitBounds:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(t){var i;return i=this.getBounds(t),this._applyBoundaryConstraints(i)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(t,i){return i?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:i}),this},zoomBy:function(t,i,n){return this.zoomTo(this.zoomSpring.target.value*t,i,n)},zoomTo:function(t,i,n){var r=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){r.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(t,i){var r=this.getBoundsNoRotate(),h=r;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(h.width=r.width*(t.x/this.containerSize.x),h.height=h.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(h,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);t();var n=this.pixelFromPoint(this.zoomPoint,!0).minus(i),r=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,i){return t.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(t,i){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(t,i){return t.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(t,i){return this.deltaPointsFromPixelsNoRotate(t,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,i){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(i))},pixelFromPoint:function(t,i){return this._pixelFromPoint(t,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,i){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(t,i){return this.pointFromPixelNoRotate(t,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}var r=this._imageToViewportDelta(t,i);return r.x+=this._contentBoundsNoRotate.x,r.y+=this._contentBoundsNoRotate.y,r},imageToViewportRectangle:function(t,i,n,r){var h=t;if(h instanceof e.Rect||(h=new e.Rect(t,i,n,r)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===l)return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,n,r,!0)}var c=this.imageToViewportCoordinates(h.x,h.y),o=this._imageToViewportDelta(h.width,h.height);return new e.Rect(c.x,c.y,o.x,o.y,h.degrees)},viewportToImageRectangle:function(t,i,n,r){var h=t;if(h instanceof e.Rect||(h=new e.Rect(t,i,n,r)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===l)return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,n,r,!0)}var c=this.viewportToImageCoordinates(h.x,h.y),o=this._viewportToImageDelta(h.width,h.height);return new e.Rect(c.x,c.y,o.x,o.y,h.degrees)},viewerElementToImageCoordinates:function(t){var i=this.pointFromPixel(t,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(t){var i=this.imageToViewportCoordinates(t);return this.pixelFromPoint(i,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}return t*(this._containerInnerSize.x/this._contentSizeNoRotate.x*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(t){return this.flipped===t||(this.flipped=t,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:t})),this}}}(OpenSeadragon),function(e){function t(o,d,g,y,T,x,S,P,R){var I=S.getBoundingBox().getTopLeft(),H=S.getBoundingBox().getBottomRight();o.viewer&&o.viewer.raiseEvent("update-level",{tiledImage:o,havedrawn:d,level:y,opacity:T,visibility:x,drawArea:S,topleft:I,bottomright:H,currenttime:P,best:R}),c(o.coverage,y),c(o.loadingCoverage,y);for(var j=o._getCornerTiles(y,I,H),F=j.topLeft,G=j.bottomRight,K=o.source.getNumTiles(y),_=o.viewport.pixelFromPoint(o.viewport.getCenter()),D=F.x;D<=G.x;D++)for(var z=F.y;z<=G.y;z++){if(!o.wrapHorizontal&&!o.wrapVertical){var M=o.source.getTileBounds(y,D,z);if(null===S.intersection(M))continue}R=i(o,g,d,D,z,y,T,x,_,K,P,R)}return R}function i(o,d,g,y,T,x,S,P,R,I,H,j){var D,z,M,N,U,C,W,A,q,Z,V,Y,Q,oe,re,ne,J,ee,te,F=(D=y,z=T,N=o,U=o.source,W=H,A=I,q=o._worldWidthCurrent,Z=o._worldHeightCurrent,(C=o.tilesMatrix)[M=x]||(C[M]={}),C[M][D]||(C[M][D]={}),C[M][D][z]||(Q=U.getTileBounds(M,V=(A.x+D%A.x)%A.x,Y=(A.y+z%A.y)%A.y),oe=U.getTileBounds(M,V,Y,!0),re=U.tileExists(M,V,Y),ne=U.getTileUrl(M,V,Y),N.loadTilesWithAjax?(J=U.getTileAjaxHeaders(M,V,Y),e.isPlainObject(N.ajaxHeaders)&&(J=e.extend({},N.ajaxHeaders,J))):J=null,ee=U.getContext2D?U.getContext2D(M,V,Y):void 0,Q.x+=(D-V)/A.x,Q.y+=Z/q*((z-Y)/A.y),te=new e.Tile(M,D,z,Q,re,ne,ee,N.loadTilesWithAjax,J,oe),V==A.x-1&&(te.isRightMost=!0),Y==A.y-1&&(te.isBottomMost=!0),C[M][D][z]=te),(te=C[M][D][z]).lastTouchTime=W,te),G=g;o.viewer&&o.viewer.raiseEvent("update-tile",{tiledImage:o,tile:F}),l(o.coverage,x,y,T,!1);var K=F.loaded||F.loading||h(o.loadingCoverage,x,y,T);if(l(o.loadingCoverage,x,y,T,K),!F.exists||(d&&!G&&(h(o.coverage,x,y,T)?l(o.coverage,x,y,T,!0):G=!0),!G))return j;if(function(D,z,M,N,U,C){var W=D.bounds.getTopLeft();W.x*=C._scaleSpring.current.value,W.y*=C._scaleSpring.current.value,W.x+=C._xSpring.current.value,W.y+=C._ySpring.current.value;var A=D.bounds.getSize();A.x*=C._scaleSpring.current.value,A.y*=C._scaleSpring.current.value;var q=M.pixelFromPointNoRotate(W,!0),Z=M.pixelFromPointNoRotate(W,!1),V=M.deltaPixelsFromPointsNoRotate(A,!0),Y=M.deltaPixelsFromPointsNoRotate(A,!1),Q=Z.plus(Y.divide(2)),oe=N.squaredDistanceTo(Q);z||(V=V.plus(new e.Point(1,1))),D.isRightMost&&C.wrapHorizontal&&(V.x+=.75),D.isBottomMost&&C.wrapVertical&&(V.y+=.75),D.position=q,D.size=V,D.squaredDistance=oe,D.visibility=U}(F,o.source.tileOverlap,o.viewport,R,P,o),!F.loaded)if(F.context2D)n(o,F);else{var _=o._tileCache.getImageRecord(F.cacheKey);_&&n(o,F,_.getImage())}return F.loaded?function(D,z,M,N,U,C,W){var A,q,Z=1e3*D.blendTime;if(z.blendStart||(z.blendStart=W),A=W-z.blendStart,q=Z?Math.min(1,A/Z):1,D.alwaysBlend&&(q*=C),z.opacity=q,D.lastDrawn.push(z),1===q)l(D.coverage,U,M,N,!0),D._hasOpaqueTile=!0;else if(A<Z)return!0;return!1}(o,F,y,T,x,S,H)&&(o._needsDraw=!0):F.loading?o._tilesLoading++:K||(j=function(D,z){return!D||z.visibility>D.visibility||z.visibility==D.visibility&&z.squaredDistance<D.squaredDistance?z:D}(j,F)),j}function n(o,d,g,y,T){var x=0;function S(){return x++,P}function P(){0==--x&&(d.loading=!1,d.loaded=!0,d.context2D||o._tileCache.cacheTile({image:g,tile:d,cutoff:y,tiledImage:o}),o._needsDraw=!0)}o.viewer.raiseEvent("tile-loaded",{tile:d,tiledImage:o,tileRequest:T,image:g,getCompletionCallback:S}),S()()}function r(o,d,g,y){var T,x,S,P;if(!o[d])return!1;if(void 0!==g&&void 0!==y)return void 0===o[d][g]||void 0===o[d][g][y]||!0===o[d][g][y];for(S in T=o[d])if(Object.prototype.hasOwnProperty.call(T,S))for(P in x=T[S])if(Object.prototype.hasOwnProperty.call(x,P)&&!x[P])return!1;return!0}function h(o,d,g,y){return void 0===g||void 0===y?r(o,d+1):r(o,d+1,2*g,2*y)&&r(o,d+1,2*g,2*y+1)&&r(o,d+1,2*g+1,2*y)&&r(o,d+1,2*g+1,2*y+1)}function l(o,d,g,y,T){o[d]?(o[d][g]||(o[d][g]={}),o[d][g][y]=T):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",d)}function c(o,d){o[d]={}}e.TiledImage=function(o){var d=this;e.console.assert(o.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(o.drawer,"[TiledImage] options.drawer is required"),e.console.assert(o.viewer,"[TiledImage] options.viewer is required"),e.console.assert(o.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(o.source,"[TiledImage] options.source is required"),e.console.assert(!o.clip||o.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=o.tileCache,delete o.tileCache,this._drawer=o.drawer,delete o.drawer,this._imageLoader=o.imageLoader,delete o.imageLoader,o.clip instanceof e.Rect&&(this._clip=o.clip.clone()),delete o.clip;var g=o.x||0;delete o.x;var y=o.y||0;delete o.y,this.normHeight=o.source.dimensions.y/o.source.dimensions.x,this.contentAspectX=o.source.dimensions.x/o.source.dimensions.y;var T=1;o.width?(T=o.width,delete o.width,o.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete o.height)):o.height&&(T=o.height/this.normHeight,delete o.height);var x=o.fitBounds;delete o.fitBounds;var S=o.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete o.fitBoundsPlacement;var P=o.degrees||0;delete o.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},o),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:g,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:T,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:P,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),x&&this.fitBounds(x,S,!0),this._drawingHandler=function(R){d.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:d},R))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(o){o!==this._fullyLoaded&&(this._fullyLoaded=o,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var o=this._xSpring.update(),d=this._ySpring.update(),g=this._scaleSpring.update(),y=this._degreesSpring.update();return!!(o||d||g||y)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(o){return this.getBoundsNoRotate(o).rotate(this.getRotation(o),this._getRotationPoint(o))},getBoundsNoRotate:function(o){return o?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(o){var d=this.getBoundsNoRotate(o);if(this._clip){var y=this._clip.times((o?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x);d=new e.Rect(d.x+y.x,d.y+y.y,y.width,y.height)}return d.rotate(this.getRotation(o),this._getRotationPoint(o))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(o,d,g){var y=g?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(o*(this.source.dimensions.x/y),d*(this.source.dimensions.y*this.contentAspectX/y))},viewportToImageCoordinates:function(o,d,g){var y;return o instanceof e.Point?(g=d,y=o):y=new e.Point(o,d),y=y.rotate(-this.getRotation(g),this._getRotationPoint(g)),g?this._viewportToImageDelta(y.x-this._xSpring.current.value,y.y-this._ySpring.current.value):this._viewportToImageDelta(y.x-this._xSpring.target.value,y.y-this._ySpring.target.value)},_imageToViewportDelta:function(o,d,g){var y=g?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(o/this.source.dimensions.x*y,d/this.source.dimensions.y/this.contentAspectX*y)},imageToViewportCoordinates:function(o,d,g){o instanceof e.Point&&(g=d,d=o.y,o=o.x);var y=this._imageToViewportDelta(o,d);return g?(y.x+=this._xSpring.current.value,y.y+=this._ySpring.current.value):(y.x+=this._xSpring.target.value,y.y+=this._ySpring.target.value),y.rotate(this.getRotation(g),this._getRotationPoint(g))},imageToViewportRectangle:function(o,d,g,y,T){var x=o;x instanceof e.Rect?T=d:x=new e.Rect(o,d,g,y);var S=this.imageToViewportCoordinates(x.getTopLeft(),T),P=this._imageToViewportDelta(x.width,x.height,T);return new e.Rect(S.x,S.y,P.x,P.y,x.degrees+this.getRotation(T))},viewportToImageRectangle:function(o,d,g,y,T){var x=o;o instanceof e.Rect?T=d:x=new e.Rect(o,d,g,y);var S=this.viewportToImageCoordinates(x.getTopLeft(),T),P=this._viewportToImageDelta(x.width,x.height,T);return new e.Rect(S.x,S.y,P.x,P.y,x.degrees-this.getRotation(T))},viewerElementToImageCoordinates:function(o){var d=this.viewport.pointFromPixel(o,!0);return this.viewportToImageCoordinates(d)},imageToViewerElementCoordinates:function(o){var d=this.imageToViewportCoordinates(o);return this.viewport.pixelFromPoint(d,!0)},windowToImageCoordinates:function(o){var d=o.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(d)},imageToWindowCoordinates:function(o){return this.imageToViewerElementCoordinates(o).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(o){var d=this._scaleSpring.current.value;return o=o.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((o.x-this._xSpring.current.value)/d,(o.y-this._ySpring.current.value)/d,o.width/d,o.height/d,o.degrees)},viewportToImageZoom:function(o){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*o},imageToViewportZoom:function(o){return o/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(o,d){var g=this._xSpring.target.value===o.x&&this._ySpring.target.value===o.y;if(d){if(g&&this._xSpring.current.value===o.x&&this._ySpring.current.value===o.y)return;this._xSpring.resetTo(o.x),this._ySpring.resetTo(o.y),this._needsDraw=!0}else{if(g)return;this._xSpring.springTo(o.x),this._ySpring.springTo(o.y),this._needsDraw=!0}g||this._raiseBoundsChange()},setWidth:function(o,d){this._setScale(o,d)},setHeight:function(o,d){this._setScale(o/this.normHeight,d)},setCroppingPolygons:function(o){try{if(!e.isArray(o))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=o.map(function(g){return function(g){return g.map(function(y){try{if((T=y)instanceof e.Point||"number"==typeof T.x&&"number"==typeof T.y)return{x:y.x,y:y.y};throw new Error}catch(x){throw new Error("A Provided cropping polygon point is not supported")}var T})}(g)})}catch(g){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(g),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(o,d,g){var y=e.Placement.properties[d=d||e.Placement.CENTER],T=this.contentAspectX,x=0,S=0,P=1,R=1;if(this._clip&&(T=this._clip.getAspectRatio(),P=this._clip.width/this.source.dimensions.x,R=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>T?(x=this._clip.x/this._clip.height*o.height,S=this._clip.y/this._clip.height*o.height):(x=this._clip.x/this._clip.width*o.width,S=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>T){var I=o.height/R,H=0;y.isHorizontallyCentered?H=(o.width-o.height*T)/2:y.isRight&&(H=o.width-o.height*T),this.setPosition(new e.Point(o.x-x+H,o.y-S),g),this.setHeight(I,g)}else{var j=o.width/P,F=0;y.isVerticallyCentered?F=(o.height-o.width/T)/2:y.isBottom&&(F=o.height-o.width/T),this.setPosition(new e.Point(o.x-x,o.y-S+F),g),this.setWidth(j,g)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(o){e.console.assert(!o||o instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=o instanceof e.Rect?o.clone():null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(o){o!==this.opacity&&(this.opacity=o,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(o){this._preload=!!o,this._needsDraw=!0},getRotation:function(o){return o?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(o,d){(this._degreesSpring.target.value!==o||!this._degreesSpring.isAtTargetValue())&&(d?this._degreesSpring.resetTo(o):this._degreesSpring.springTo(o),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(o){return this.getBoundsNoRotate(o).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(o){o!==this.compositeOperation&&(this.compositeOperation=o,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(o,d){var g=this._scaleSpring.target.value===o;if(d){if(g&&this._scaleSpring.current.value===o)return;this._scaleSpring.resetTo(o),this._updateForScale(),this._needsDraw=!0}else{if(g)return;this._scaleSpring.springTo(o),this._updateForScale(),this._needsDraw=!0}g||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var o=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),d=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,g=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(d/this.minPixelRatio)/Math.log(2))));return g=Math.max(g,this.source.minLevel||0),{lowestLevel:o=Math.min(o,g),highestLevel:g}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var _,D,z,o=this.viewport,d=this._viewportToTiledImageRectangle(o.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var g=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(d=d.intersection(g)))return}for(var y=this._getLevelsInterval(),T=y.lowestLevel,x=y.highestLevel,S=null,P=!1,R=e.now(),I=x;T<=I;I--){var H=!1,j=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(I),!0).x*this._scaleSpring.current.value;if(I===T||!P&&j>=this.minPixelRatio)P=H=!0;else if(!P)continue;var F=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(I),!1).x*this._scaleSpring.current.value,G=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,K=this.immediateRender?1:G;if(S=t(this,P,H,I,Math.min(1,(j-.5)/.5),K/Math.abs(K-F),d,R,S),r(this.coverage,I))break}(function(_,D){if(0!==_.opacity&&(0!==D.length||_.placeholderFillStyle)){var M,z=D[0];z&&(M=_.opacity<1||_.compositeOperation&&"source-over"!==_.compositeOperation||!_._isBottomItem()&&z._hasTransparencyChannel());var N,U,A,C=_.viewport.getZoom(!0),W=_.viewportToImageZoom(C);1<D.length&&W>_.smoothTileEdgesMinZoom&&!_.iOSDevice&&_.getRotation(!0)%360==0&&e.supportsCanvas&&(M=!0,N=z.getScaleForEdgeSmoothing(),U=z.getTranslationForEdgeSmoothing(N,_._drawer.getCanvasSize(!1),_._drawer.getCanvasSize(!0))),M&&(N||(A=_.viewport.viewportToViewerElementRectangle(_.getClippedBounds(!0)).getIntegerBoundingBox(),_._drawer.viewer.viewport.getFlip()&&(0===_.viewport.degrees&&_.getRotation(!0)%360==0||(A.x=_._drawer.viewer.container.clientWidth-(A.x+A.width))),A=A.times(e.pixelDensityRatio)),_._drawer._clear(!0,A)),N||(0!==_.viewport.degrees&&_._drawer._offsetForRotation({degrees:_.viewport.degrees,useSketch:M}),_.getRotation(!0)%360!=0&&_._drawer._offsetForRotation({degrees:_.getRotation(!0),point:_.viewport.pixelFromPointNoRotate(_._getRotationPoint(!0),!0),useSketch:M}),0===_.viewport.degrees&&_.getRotation(!0)%360==0&&_._drawer.viewer.viewport.getFlip()&&_._drawer._flip());var q=!1;if(_._clip){_._drawer.saveContext(M);var Z=_.imageToViewportRectangle(_._clip,!0);Z=Z.rotate(-_.getRotation(!0),_._getRotationPoint(!0));var V=_._drawer.viewportToDrawerRectangle(Z);N&&(V=V.times(N)),U&&(V=V.translate(U)),_._drawer.setClip(V,M),q=!0}if(_._croppingPolygons){_._drawer.saveContext(M);try{var Y=_._croppingPolygons.map(function(ne){return ne.map(function(J){var ee=_.imageToViewportCoordinates(J.x,J.y,!0).rotate(-_.getRotation(!0),_._getRotationPoint(!0)),te=_._drawer.viewportCoordToDrawerCoord(ee);return N&&(te=te.times(N)),te})});_._drawer.clipWithPolygons(Y,M)}catch(ne){e.console.error(ne)}q=!0}if(_.placeholderFillStyle&&!1===_._hasOpaqueTile){var oe,Q=_._drawer.viewportToDrawerRectangle(_.getBounds(!0));N&&(Q=Q.times(N)),U&&(Q=Q.translate(U)),oe="function"==typeof _.placeholderFillStyle?_.placeholderFillStyle(_,_._drawer.context):_.placeholderFillStyle,_._drawer.drawRectangle(Q,oe,M)}for(var re=D.length-1;0<=re;re--)_._drawer.drawTile(z=D[re],_._drawingHandler,M,N,U),z.beingDrawn=!0,_.viewer&&_.viewer.raiseEvent("tile-drawn",{tiledImage:_,tile:z});q&&_._drawer.restoreContext(M),N||(_.getRotation(!0)%360!=0&&_._drawer._restoreRotationChanges(M),0!==_.viewport.degrees&&_._drawer._restoreRotationChanges(M)),M&&(N&&(0!==_.viewport.degrees&&_._drawer._offsetForRotation({degrees:_.viewport.degrees,useSketch:!1}),_.getRotation(!0)%360!=0&&_._drawer._offsetForRotation({degrees:_.getRotation(!0),point:_.viewport.pixelFromPointNoRotate(_._getRotationPoint(!0),!0),useSketch:!1})),_._drawer.blendSketch({opacity:_.opacity,scale:N,translate:U,compositeOperation:_.compositeOperation,bounds:A}),N&&(_.getRotation(!0)%360!=0&&_._drawer._restoreRotationChanges(!1),0!==_.viewport.degrees&&_._drawer._restoreRotationChanges(!1))),N||0===_.viewport.degrees&&_.getRotation(!0)%360==0&&_._drawer.viewer.viewport.getFlip()&&_._drawer._flip(),function(ne,J){if(ne.debugMode)for(var ee=J.length-1;0<=ee;ee--){var te=J[ee];try{ne._drawer.drawDebugInfo(te,J.length,ee,ne)}catch(ae){e.console.error(ae)}}}(_,D)}})(this,this.lastDrawn),S&&!S.context2D?(_=this,z=R,(D=S).loading=!0,_._imageLoader.addJob({src:D.url,loadWithAjax:D.loadWithAjax,ajaxHeaders:D.ajaxHeaders,crossOriginPolicy:_.crossOriginPolicy,ajaxWithCredentials:_.ajaxWithCredentials,callback:function(M,N,U){!function(C,W,A,q,Z,V){if(!q)return e.console.log("Tile %s failed to load: %s - error: %s",W,W.url,Z),C.viewer.raiseEvent("tile-load-failed",{tile:W,tiledImage:C,time:A,message:Z,tileRequest:V}),W.loading=!1,void(W.exists=!1);if(A<C.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",W,W.url),void(W.loading=!1);function Y(){var Q=C.source.getClosestLevel();n(C,W,q,Q,V)}C._midDraw?window.setTimeout(Y,1):Y()}(_,D,z,M,N,U)},abort:function(){D.loading=!1}}),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(o,d,g){var y,T;this.wrapHorizontal?(y=e.positiveModulo(d.x,1),T=e.positiveModulo(g.x,1)):(y=Math.max(0,d.x),T=Math.min(1,g.x));var x,S,P=1/this.source.aspectRatio;this.wrapVertical?(x=e.positiveModulo(d.y,P),S=e.positiveModulo(g.y,P)):(x=Math.max(0,d.y),S=Math.min(P,g.y));var R=this.source.getTileAtPoint(o,new e.Point(y,x)),I=this.source.getTileAtPoint(o,new e.Point(T,S)),H=this.source.getNumTiles(o);return this.wrapHorizontal&&(R.x+=H.x*Math.floor(d.x),I.x+=H.x*Math.floor(g.x)),this.wrapVertical&&(R.y+=H.y*Math.floor(d.y/P),I.y+=H.y*Math.floor(g.y/P)),{topLeft:R,bottomRight:I}}})}(OpenSeadragon),function(e){function t(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage}function i(n){e.console.assert(n,"[ImageRecord] options is required"),e.console.assert(n.image,"[ImageRecord] options.image is required"),this._image=n.image,this._tiles=[]}i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var n=document.createElement("canvas");n.width=this._image.width,n.height=this._image.height,this._renderedContext=n.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(n){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=n},addTile:function(n){e.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var r=0;r<this._tiles.length;r++)if(this._tiles[r]===n)return void this._tiles.splice(r,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(n){this._maxImageCacheCount=(n=n||{}).maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=n.cutoff||0,h=this._tilesLoaded.length,l=this._imagesLoaded[n.tile.cacheKey];if(l||(e.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),l=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),l.addTile(n.tile),n.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var g,y,x,P,c=null,o=-1,d=null,R=this._tilesLoaded.length-1;0<=R;R--)(g=(P=this._tilesLoaded[R]).tile).level<=r||g.beingDrawn||(c?((x=g.lastTouchTime)<(y=c.lastTouchTime)||x==y&&c.level<g.level)&&(c=g,o=R,d=P):(c=g,o=R,d=P));c&&0<=o&&(this._unloadTile(d),h=o)}this._tilesLoaded[h]=new t({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){e.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var r,h=0;h<this._tilesLoaded.length;++h)(r=this._tilesLoaded[h]).tiledImage===n&&(this._unloadTile(r),this._tilesLoaded.splice(h,1),h--)},getImageRecord:function(n){return e.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){e.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var r=n.tile,h=n.tiledImage;r.unload(),r.cacheImageRecord=null;var l=this._imagesLoaded[r.cacheKey];l.removeTile(r),l.getTileCount()||(l.destroy(),delete this._imagesLoaded[r.cacheKey],this._imagesLoadedCount--),h.viewer.raiseEvent("tile-unloaded",{tile:r,tiledImage:h})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var t,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(t=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<n.length;i++)this._raiseRemoveItem(t=n[i])},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,i=0;i<this._items.length;i++)t=this._items[i].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){(this._autoRefigureSizes=t)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var o,i=(t=t||{}).immediately||!1,n=t.layout||e.DEFAULT_SETTINGS.collectionLayout,h=t.columns||e.DEFAULT_SETTINGS.collectionColumns,l=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,c=l+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);o=!t.rows&&h?h:Math.ceil(this._items.length/(t.rows||e.DEFAULT_SETTINGS.collectionRows));var y,T,x,S,P,d=0,g=0;this.setAutoRefigureSizes(!1);for(var R=0;R<this._items.length;R++)R&&R%o==0&&("horizontal"===n?(g+=c,d=0):(d+=c,g=0)),S=(x=(T=(y=this._items[R]).getBounds()).width>T.height?l:l*(T.width/T.height))*(T.height/T.width),P=new e.Point(d+(l-x)/2,g+(l-S)/2),y.setPosition(P,i),y.setWidth(x,i),"horizontal"===n?d+=c:g+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var r=this._items[0],h=r.getBounds();this._contentFactor=r.getContentSize().x/h.width;for(var l=r.getClippedBounds().getBoundingBox(),c=l.x,o=l.y,d=l.x+l.width,g=l.y+l.height,y=1;y<this._items.length;y++)h=(r=this._items[y]).getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/h.width),l=r.getClippedBounds().getBoundingBox(),c=Math.min(c,l.x),o=Math.min(o,l.y),d=Math.max(d,l.x+l.width),g=Math.max(g,l.y+l.height);this._homeBounds=new e.Rect(c,o,d-c,g-o),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon);